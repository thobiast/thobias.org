<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>~/ibm/pessoal/public_html/htdocs/tsm/tsmmonitor/tsmmonitor.html</title>
<meta name="Generator" content="Vim/7.2">
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
</head>
<body bgcolor="#ffffff" text="#000000"><font face="monospace">
<font color="#0000ff">#!/bin/sh</font><br>
<font color="#0000ff"># tsmmonitor - IBM TSM (Tivoli Storage Manager) monitoring script</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># Homepage: <a href="http://thobias.org/tsm">http://thobias.org/tsm</a></font><br>
<font color="#0000ff"># Author&nbsp;&nbsp;: Thobias Salazar Trevisan (thobias at thobias.org)</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># Changelog (DD/MM/YYYY):</font><br>
<font color="#0000ff"># 07/11/2012 - version 2.2</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;added support for TSM 6 for db and log checks</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dbbkp - replaced sed by egrep. AIX sed does not have OR oper</font><br>
<font color="#0000ff"># 11/04/2009 - version 2.1</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;added falseprivate check</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fixed bug drmvol</font><br>
<font color="#0000ff"># 28/11/2008 - version 2.0</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the source code was rewritten.</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;there were changes on the command line options, so version 2.0</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BREAKS BACKWARDS COMPATIBILITY.</font><br>
<font color="#0000ff"># 15/06/2007 - first version</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">##############################################################################</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># DOCUMENTATION</font><br>
<font color="#0000ff"># =============</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">#&nbsp;&nbsp; This script is developed to provide an easy, customizable and effective</font><br>
<font color="#0000ff">#&nbsp;&nbsp; way to monitor TSM Servers.</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">#&nbsp;&nbsp; It is composed of functions to check specific TSM resources.</font><br>
<font color="#0000ff">#&nbsp;&nbsp; Each check returns the resource status. The available status for a</font><br>
<font color="#0000ff">#&nbsp;&nbsp; resource are:</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Ok / Warning / Critical</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">#&nbsp;&nbsp; The status returned is based on defined thresholds for each check.</font><br>
<font color="#0000ff">#&nbsp;&nbsp; For example, the function to check the TSM Database utilization:</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prompt&gt; ./tsmmonitor db -h</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;check tsm database utilization</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The default percentages are:</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; warning..: 85</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; critical.: 90</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Usage..: tsmmonitor db [options] [warning] [critical]</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -v6&nbsp;&nbsp;&nbsp;&nbsp; check database utilization for TSM version 6</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Usage..: tsmmonitor db [warning] [critical]</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Example: tsmmonitor db</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tsmmonitor db 80 95</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tsmmonitor db -v6 80 90</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">#&nbsp;&nbsp; The status returned from db check depends on the warning and critical</font><br>
<font color="#0000ff">#&nbsp;&nbsp; threshold values. These values can be customized using command line</font><br>
<font color="#0000ff">#&nbsp;&nbsp; arguments:</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prompt&gt; ./tsmmonitor db</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db: database utilization 81%, OK</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prompt&gt; ./tsmmonitor db 80 90</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db: database utilization 81%, Warning</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prompt&gt; ./tsmmonitor db 60 80</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db: database utilization 81%, Critical</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">#&nbsp;&nbsp; Some nice features:</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp; * Supports multiples tsm servers (servername)</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp; * Can be used transparently as a nagios plugin</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp; * Alert notification mechanism (by e-mail)</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp; * Customizable threshold values for ok/warning/critical status in command line</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp; * Bourne shell (sh) compliance</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp; * Easy to add news checks </font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">#&nbsp;&nbsp; This script should work fine under most *NIX variants. It has been tested</font><br>
<font color="#0000ff">#&nbsp;&nbsp; successfully under many Linux and AIX (4.3, 5.2 and 5.3). If you have any</font><br>
<font color="#0000ff">#&nbsp;&nbsp; problem, please let me know. </font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># Nagios</font><br>
<font color="#0000ff"># ======</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">#&nbsp;&nbsp; TSMmonitor can be used transparently as nagios plugin. Nagios plugins</font><br>
<font color="#0000ff">#&nbsp;&nbsp; are based on check return code: </font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp; 0 - normal</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp; 1 - warning</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp; 2 - critical</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp; 3 - unknown</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">#&nbsp;&nbsp; These are the same return codes used by tsmmonitor.</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># TSMmonitor Help</font><br>
<font color="#0000ff"># ===============</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">#&nbsp;&nbsp; $ ./tsmmonitor -h</font><br>
<font color="#0000ff">#&nbsp;&nbsp; Usage: tsmmonitor [options] [check] [options_check]</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">#&nbsp;&nbsp; These are global options. They can be used in all checks.</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">#&nbsp;&nbsp; -u, --user&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsm user to connect to the tsm server</font><br>
<font color="#0000ff">#&nbsp;&nbsp; -p, --pass&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsm user password to connect to the tsm server</font><br>
<font color="#0000ff">#&nbsp;&nbsp; -s, --servername&nbsp;&nbsp;&nbsp;&nbsp;specify tsm servername</font><br>
<font color="#0000ff">#&nbsp;&nbsp; -m, --mail&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mail addresses separated by blank space</font><br>
<font color="#0000ff">#&nbsp;&nbsp; -q, --quiet&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; quiet mode, suppress all output (except errors)</font><br>
<font color="#0000ff">#&nbsp;&nbsp; -S, --source&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print the check source code</font><br>
<font color="#0000ff">#&nbsp;&nbsp; -h, --help&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print this help information and exit</font><br>
<font color="#0000ff">#&nbsp;&nbsp; -V, --version&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print program version and exit</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">#&nbsp;&nbsp; The following checks are available:</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">#&nbsp;&nbsp; help, db, log, scratch, drive, path, dbfrag, unav, stgpool, volerr, </font><br>
<font color="#0000ff">#&nbsp;&nbsp; volreclaim, tapeslib, tapesown, tapesstgpool, dbbkp, numsess, numnodes,</font><br>
<font color="#0000ff">#&nbsp;&nbsp; nodeslocked, diskvol, dbvol, searchanr, drmvol, lic</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">#&nbsp;&nbsp; Try 'tsmmonitor &lt;check&gt; --help' for more information.</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">#&nbsp;&nbsp; Example:</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tsmmonitor db --help</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tsmmonitor db</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tsmmonitor db -v6</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tsmmonitor -m='user1@somewhere.com user2@somewhere.com' db</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tsmmonitor --servername=tsmsrv01 db</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tsmmonitor --servername=tsmsrv02 db 85 95</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tsmmonitor -u=user1 -p=xxx -s=tsmsrv02 db 85 95</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># Check Example</font><br>
<font color="#0000ff"># =============</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">#&nbsp;&nbsp; Here is an example of using this script to check tsm db utilization:</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp; prompt&gt; ./tsmmonitor db -h</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp; check tsm database utilization</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp; The default percentages are:</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;warning..: 85</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;critical.: 90</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp; Usage..: tsmmonitor db [warning] [critical]</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp; Example: tsmmonitor db</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor db 80 95</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp; prompt&gt; ./tsmmonitor -u=user1 -p=my_pass -s=tsmsrv02 db</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp; db - tsmserver tsmsrv02: database utilization 81%, OK</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp; prompt&gt; echo $?</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp; 0</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp; prompt&gt; ./tsmmonitor -u=user1 -p=my_pass -s=tsmsrv02 db 80 90</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp; db - tsmserver tsmsrv02: database utilization 81%, Warning</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp; prompt&gt; echo $?</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp; 1</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp; prompt&gt; ./tsmmonitor -u=user1 -p=my_pass -s=tsmsrv02 db 60 80</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp; db - tsmserver tsmsrv02: database utilization 81%, Critical</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp; prompt&gt; echo $?</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp; 2</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">##############################################################################</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Configuration Area</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ==================</font><br>
<br>
<font color="#0000ff">###################################</font><br>
<font color="#0000ff">########## tsm server information #</font><br>
<font color="#0000ff">###################################</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># dsmadmc command path</font><br>
<font color="#008b8b">DSMADMC</font>=<font color="#a52a2a"><b>'</b></font><font color="#ff00ff">/usr/bin/dsmadmc</font><font color="#a52a2a"><b>'</b></font><br>
<br>
<font color="#0000ff"># tsm user</font><br>
<font color="#008b8b">USER</font>=<font color="#a52a2a"><b>''</b></font><br>
<br>
<font color="#0000ff"># tsm user password</font><br>
<font color="#008b8b">PASS</font>=<font color="#a52a2a"><b>''</b></font><br>
<br>
<font color="#0000ff"># dsm error log</font><br>
<font color="#0000ff">#DSM_LOG=/home/nagios</font><br>
<font color="#0000ff">#export DSM_LOG</font><br>
<br>
<font color="#0000ff">##############################</font><br>
<font color="#0000ff">########## send notification #</font><br>
<font color="#0000ff">##############################</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># at every time that a check changes the status,</font><br>
<font color="#0000ff"># an alert (notification) will be sent by mail. default is off</font><br>
<font color="#008b8b">SEND_ALERT</font>=<font color="#ff00ff">0</font><br>
&nbsp;<br>
<font color="#0000ff"># e-mails which will receive the notifications. mail addresses are separated</font><br>
<font color="#0000ff"># by blank space. ex: MAILTO='xxx@yyy.zzz aaa@bbb.zzz ppp@qqq.lll'</font><br>
<font color="#008b8b">MAILTO</font>=<font color="#a52a2a"><b>''</b></font><br>
&nbsp;<br>
<font color="#0000ff"># temp directory where tsmmonitor will record check status.</font><br>
<font color="#0000ff"># it is necessary to send mail when the check status changes</font><br>
<font color="#008b8b">TEMPDIR</font>=<font color="#a52a2a"><b>'</b></font><font color="#ff00ff">/tmp</font><font color="#a52a2a"><b>'</b></font><br>
&nbsp;<br>
<font color="#0000ff">########################</font><br>
<font color="#0000ff">########## other flags #</font><br>
<font color="#0000ff">########################</font><br>
<font color="#0000ff">#</font><br>
<font color="#008b8b">DEBUG</font>=<font color="#ff00ff">0</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#0000ff"># do not edit here, please use --debug</font><br>
<font color="#008b8b">COLOR_DEBUG</font>=<font color="#ff00ff">1</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#0000ff"># show debug messages in colors?</font><br>
<font color="#008b8b">QUIET</font>=<font color="#ff00ff">0</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#0000ff"># do not edit here, please use --quiet</font><br>
<font color="#008b8b">SHOW_CHECK_SOURCE</font>=<font color="#ff00ff">0</font>&nbsp;<font color="#0000ff"># do not edit here, please use --source</font><br>
<br>
<font color="#0000ff">################################</font><br>
<font color="#0000ff">########## program information #</font><br>
<font color="#0000ff">################################</font><br>
<font color="#0000ff">#</font><br>
<font color="#008b8b">URL</font>=<font color="#a52a2a"><b>'</b></font><font color="#ff00ff"><a href="http://thobias.org/tsm">http://thobias.org/tsm</a></font><font color="#a52a2a"><b>'</b></font><br>
<font color="#008b8b">VERSION</font>=<font color="#a52a2a"><b>'</b></font><font color="#ff00ff">2.2</font><font color="#a52a2a"><b>'</b></font><br>
<br>
<font color="#0000ff">#####################################################################</font><br>
<font color="#0000ff">########## default check threshold&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</font><br>
<font color="#0000ff">########## used to determine the check status (ok/warning/critical) #</font><br>
<font color="#0000ff">##########&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</font><br>
<font color="#0000ff">########## These values can be changed through command line options #</font><br>
<font color="#0000ff">########## prompt&gt; tsmmonitor &lt;check&gt; --help&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</font><br>
<font color="#0000ff">#####################################################################</font><br>
<font color="#0000ff"># check: database utilization</font><br>
<font color="#008b8b">DB_WARNING</font>=<font color="#ff00ff">85</font><br>
<font color="#008b8b">DB_CRITICAL</font>=<font color="#ff00ff">90</font><br>
<font color="#0000ff"># check: log utilization</font><br>
<font color="#008b8b">LOG_WARNING</font>=<font color="#ff00ff">60</font><br>
<font color="#008b8b">LOG_CRITICAL</font>=<font color="#ff00ff">80</font><br>
<font color="#0000ff"># check: scratch tape number</font><br>
<font color="#008b8b">SC_WARNING</font>=<font color="#ff00ff">10</font><br>
<font color="#008b8b">SC_CRITICAL</font>=<font color="#ff00ff">6</font><br>
<font color="#0000ff"># check: number of paths not online</font><br>
<font color="#008b8b">PATH_WARNING</font>=<font color="#ff00ff">1</font><br>
<font color="#008b8b">PATH_CRITICAL</font>=<font color="#ff00ff">3</font><br>
<font color="#0000ff"># check: number of drives not online</font><br>
<font color="#008b8b">DRIVE_WARNING</font>=<font color="#ff00ff">1</font><br>
<font color="#008b8b">DRIVE_CRITICAL</font>=<font color="#ff00ff">3</font><br>
<font color="#0000ff"># check tsm database fragmantation</font><br>
<font color="#008b8b">DBFRAG_WARNING</font>=<font color="#ff00ff">60</font><br>
<font color="#008b8b">DBFRAG_CRITICAL</font>=<font color="#ff00ff">80</font><br>
<font color="#0000ff"># check: number of unavailable volumes</font><br>
<font color="#008b8b">UNAV_WARNING</font>=<font color="#ff00ff">1</font><br>
<font color="#008b8b">UNAV_CRITICAL</font>=<font color="#ff00ff">5</font><br>
<font color="#0000ff"># check: storage pool utilization</font><br>
<font color="#008b8b">STGPOOL_WARNING</font>=<font color="#ff00ff">80</font><br>
<font color="#008b8b">STGPOOL_CRITICAL</font>=<font color="#ff00ff">95</font><br>
<font color="#0000ff"># check: number of volumes with error</font><br>
<font color="#008b8b">VOLERR_WARNING</font>=<font color="#ff00ff">1</font><br>
<font color="#008b8b">VOLERR_CRITICAL</font>=<font color="#ff00ff">5</font><br>
<font color="#0000ff"># check: number of volumes with pct reclaim greather than XX</font><br>
<font color="#008b8b">VOLRECL_WARNING</font>=<font color="#ff00ff">5</font><br>
<font color="#008b8b">VOLRECL_CRITICAL</font>=<font color="#ff00ff">20</font><br>
<font color="#0000ff"># check: number of tapes in the library</font><br>
<font color="#008b8b">TAPESLIB_WARNING</font>=<font color="#ff00ff">90</font><br>
<font color="#008b8b">TAPESLIB_CRITICAL</font>=<font color="#ff00ff">86</font><br>
<font color="#0000ff"># check: number of tapes with a specific owner</font><br>
<font color="#008b8b">TAPESOWN_WARNING</font>=<font color="#ff00ff">2</font><br>
<font color="#008b8b">TAPESOWN_CRITICAL</font>=<font color="#ff00ff">3</font><br>
<font color="#0000ff"># check: number of tapes in a specific storage pool</font><br>
<font color="#008b8b">TAPESSTGPOOL_WARNING</font>=<font color="#ff00ff">40</font><br>
<font color="#008b8b">TAPESSTGPOOL_CRITICAL</font>=<font color="#ff00ff">50</font><br>
<font color="#0000ff"># check: number of tsm db backup in the last 24 hours</font><br>
<font color="#008b8b">DBBKP_WARNING</font>=<font color="#ff00ff">0</font><br>
<font color="#008b8b">DBBKP_CRITICAL</font>=<font color="#ff00ff">0</font><br>
<font color="#0000ff"># check:&nbsp;&nbsp;number of nodes session</font><br>
<font color="#008b8b">NUMSESS_WARNING</font>=<font color="#ff00ff">15</font><br>
<font color="#008b8b">NUMSESS_CRITICAL</font>=<font color="#ff00ff">20</font><br>
<font color="#0000ff"># check: number of nodes locked</font><br>
<font color="#008b8b">NUMNODESLOCKED_WARNING</font>=<font color="#ff00ff">1</font><br>
<font color="#008b8b">NUMNODESLOCKED_CRITICAL</font>=<font color="#ff00ff">4</font><br>
<font color="#0000ff"># check: number of nodes</font><br>
<font color="#008b8b">NUMNODES_WARNING</font>=<font color="#ff00ff">80</font><br>
<font color="#008b8b">NUMNODES_CRITICAL</font>=<font color="#ff00ff">90</font><br>
<font color="#0000ff"># check: search for an specific ANR in actlog</font><br>
<font color="#008b8b">SEARCHANR_WARNING</font>=<font color="#ff00ff">1</font><br>
<font color="#008b8b">SEARCHANR_CRITICAL</font>=<font color="#ff00ff">3</font><br>
<font color="#0000ff"># Check: number of disk volumes without readwrite access</font><br>
<font color="#008b8b">DISKVOL_WARNING</font>=<font color="#ff00ff">1</font><br>
<font color="#008b8b">DISKVOL_CRITICAL</font>=<font color="#ff00ff">4</font><br>
<font color="#0000ff"># Check: number of drm volumes with state different from mountable</font><br>
<font color="#008b8b">DRMVOL_WARNING</font>=<font color="#ff00ff">1</font><br>
<font color="#008b8b">DRMVOL_CRITICAL</font>=<font color="#ff00ff">4</font><br>
<font color="#0000ff"># Check: number of database volumes not synchronized</font><br>
<font color="#008b8b">DBVOL_WARNING</font>=<font color="#ff00ff">1</font><br>
<font color="#008b8b">DBVOL_CRITICAL</font>=<font color="#ff00ff">2</font><br>
<font color="#0000ff"># Check: number of log volumes not synchronized</font><br>
<font color="#008b8b">LOGVOL_WARNING</font>=<font color="#ff00ff">1</font><br>
<font color="#008b8b">LOGVOL_CRITICAL</font>=<font color="#ff00ff">2</font><br>
<font color="#0000ff"># Check number of schedules not completed</font><br>
<font color="#008b8b">SCHED_WARNING</font>=<font color="#ff00ff">1</font><br>
<font color="#008b8b">SCHED_CRITICAL</font>=<font color="#ff00ff">3</font><br>
<font color="#0000ff"># check for false private tapes</font><br>
<font color="#008b8b">FALSEPRIV_WARNING</font>=<font color="#ff00ff">1</font><br>
<font color="#008b8b">FALSEPRIV_CRITICAL</font>=<font color="#ff00ff">3</font><br>
<br>
<br>
<font color="#0000ff">##############################################################################</font><br>
<br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#0000ff"># #### This section has some functions. These are for internal use only</font><br>
<font color="#0000ff"># #### not for users</font><br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<br>
<font color="#0000ff"># Mini tools </font><br>
<font color="#008b8b">_tsmmonitor_tool ()</font><br>
<font color="#008b8b">{</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>case</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>in</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;program_help <font color="#a52a2a"><b>)</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cat - <font color="#a52a2a"><b>&lt;&lt;-END</b></font><font color="#ff00ff">&nbsp;</font><br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Usage: tsmmonitor [options] [check] [options_check]</font><br>
<br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Options</font><br>
<br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-u, --user&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsm user to connect to the tsm server</font><br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-p, --pass&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsm user password to connect to the tsm server</font><br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-s, --servername&nbsp;&nbsp;&nbsp;&nbsp;specify tsm servername</font><br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-m, --mail&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mail addresses separated by blank space</font><br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-q, --quiet&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; quiet mode, suppress all output (except errors)</font><br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-S, --source&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print the check source code</font><br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-h, --help&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print this help information and exit</font><br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-V, --version&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print program version and exit</font><br>
<br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The following checks are available:</font><br>
<br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">_tsmmonitor_tool list_checks</font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><br>
<br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Try 'tsmmonitor &lt;check&gt; --help' for more information.</font><br>
<br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Example:</font><br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor db --help</font><br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor db</font><br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor db -v6</font><br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor -m='user1@somewhere.com user2@somewhere.com' db</font><br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor --servername=tsmsrv01 db</font><br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor --servername=tsmsrv02 db 85 95</font><br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor -u=user1 -p=xxx -s=tsmsrv02 db 85 95</font><br>
<br>
<font color="#a52a2a"><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>exit</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>;;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;program_version <font color="#a52a2a"><b>)</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">tsmmonitor version </font><font color="#a020f0">$VERSION</font><font color="#ff00ff">&nbsp;&lt;</font><font color="#a020f0">$URL</font><font color="#ff00ff">&gt;</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>exit</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>;;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># show available checks</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list_checks <font color="#a52a2a"><b>)</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># sed does the magic reading from the source code to</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># get the available check list</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cat <font color="#a020f0">$0</font>&nbsp;<font color="#a52a2a"><b>|</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sed -n <font color="#a52a2a"><b>'</b></font><font color="#ff00ff">s/^</font><font color="#6a5acd">\(</font><font color="#ff00ff">[a-zA-Z]\{1,\}</font><font color="#6a5acd">\)</font><font color="#ff00ff">&nbsp;()/\1/p</font><font color="#a52a2a"><b>'</b></font>&nbsp;<font color="#a52a2a"><b>|</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sed <font color="#a52a2a"><b>'</b></font><font color="#ff00ff">:a</font><br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$!N</font><br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s/\n/, /</font><br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t a</font><font color="#a52a2a"><b>'</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>;;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># test if the parameters are numbers</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is_number <font color="#a52a2a"><b>)</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>shift</b></font>&nbsp;<font color="#0000ff"># $1 = tool name (is_number)</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>for </b></font>i <font color="#a52a2a"><b>in</b></font>&nbsp;<font color="#a020f0">$*</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>do</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$i</font><font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>|</b></font>&nbsp;grep -qs <font color="#a52a2a"><b>'</b></font><font color="#ff00ff">^[0-9]\{1,\}$</font><font color="#a52a2a"><b>'</b></font>&nbsp;<font color="#a52a2a"><b>||</b></font>&nbsp;<font color="#a52a2a"><b>return</b></font>&nbsp;<font color="#ff00ff">1</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>done</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>;;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># send mail, print the tsmmonitor output and exit with the right return code</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myecho <font color="#a52a2a"><b>)</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">retcode</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">0</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">check</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$2</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>shift</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>shift</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$SERVERNAME</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#008b8b">SERVERNAME</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">&nbsp;tsmserver </font><font color="#a020f0">${</font><font color="#a020f0">SERVERNAME</font><span style="background-color: #ff0000"><font color="#ffffff">#*=</font></span><font color="#a020f0">}</font><font color="#ff00ff">:</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Send e-mail is enabled?!</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$SEND_ALERT</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;1&quot;</font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;_SendAlert <font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$check</font><font color="#ff00ff">:</font><font color="#a020f0">$SERVERNAME</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a020f0">$*</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># print the check output</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$QUIET</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;0&quot;</font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#a52a2a"><b>echo</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$check</font><font color="#ff00ff">&nbsp;-</font><font color="#a020f0">$SERVERNAME</font><font color="#ff00ff">&nbsp;</font><font color="#a020f0">$*</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Return code depend on check output</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = return code 0</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># warning&nbsp;&nbsp;= return code 1</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># critical = return code 2</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$*</font><font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>|</b></font>&nbsp;grep -iqs <font color="#a52a2a"><b>'</b></font><font color="#ff00ff">,&nbsp;&nbsp;*critical</font><font color="#a52a2a"><b>'</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#008b8b">retcode</font>=<font color="#ff00ff">2</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$*</font><font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>|</b></font>&nbsp;grep -iqs <font color="#a52a2a"><b>'</b></font><font color="#ff00ff">,&nbsp;&nbsp;*warning</font><font color="#a52a2a"><b>'</b></font>&nbsp;&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#008b8b">retcode</font>=<font color="#ff00ff">1</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_Debug <font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">tsmmonitor return code: </font><font color="#a020f0">$retcode</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># exit with correct return code</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$retcode</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>;;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Connect to tsm server and execute the sql statement</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;run_select <font color="#a52a2a"><b>)</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local temp_output<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">check</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$2</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">sql</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$3</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Connect to tsm server and run the select statement</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">temp_output</font>=<span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#a020f0">$TSM_CMD</font><font color="#6a5acd">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$sql</font><font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># test if dsmamdc was executed without error</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>if </b></font><font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$?</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;0&quot;</font>&nbsp;<font color="#a52a2a"><b>-o</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$?</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;11&quot;</font>&nbsp;<font color="#a52a2a"><b>]</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>then</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_Debug <font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$temp_output</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>&gt;</b></font>&nbsp;/dev/tty<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Check the tsm command return code</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_tsmmonitor_tool check_retcode <font color="#a020f0">$check</font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$temp_output</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$temp_output</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>else</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_Debug <font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$temp_output</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>&gt;</b></font>&nbsp;/dev/tty<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Error executing the command dsmadmc</font><font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&gt;</b></font>&nbsp;/dev/tty<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$temp_output</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>fi</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>;;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># check if the tsm command ran without errors</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;check_retcode <font color="#a52a2a"><b>)</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local retcode<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">check</font>=<font color="#a020f0">$2</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>shift</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>shift</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># search the tsm command return code</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">retcode</font>=<span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">echo </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font><font color="#6a5acd">&nbsp;</font><font color="#a52a2a"><b>|</b></font><br>
<font color="#6a5acd">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sed -n </font><font color="#a52a2a"><b>'</b></font><font color="#ff00ff">s/.*ighest return code was *</font><font color="#6a5acd">\(</font><font color="#ff00ff">[0-9]*</font><font color="#6a5acd">\)</font><font color="#ff00ff">\./\1/p</font><font color="#a52a2a"><b>'</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Return code zero</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$retcode</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;0&quot;</font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#a52a2a"><b>return</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Known return code different from 0 that it's not an error</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$retcode</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;11&quot;</font>&nbsp;<font color="#a52a2a"><b>-a</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$check</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;req&quot;</font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#a52a2a"><b>return</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$retcode</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;11&quot;</font>&nbsp;<font color="#a52a2a"><b>-a</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$check</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;numnodes&quot;</font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#a52a2a"><b>return</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$retcode</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;11&quot;</font>&nbsp;<font color="#a52a2a"><b>-a</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$check</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;unav&quot;</font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#a52a2a"><b>return</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$retcode</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;11&quot;</font>&nbsp;<font color="#a52a2a"><b>-a</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$check</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;volerr&quot;</font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#a52a2a"><b>return</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$retcode</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;11&quot;</font>&nbsp;<font color="#a52a2a"><b>-a</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$check</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;diskvol&quot;</font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#a52a2a"><b>return</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># if we get here, there was a error at tsm command execution</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># print the error</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Check </font><font color="#a020f0">$check</font><font color="#ff00ff">&nbsp;error: return code </font><font color="#a020f0">$retcode</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_Debug <font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">echo </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font><font color="#6a5acd">&nbsp;</font><font color="#a52a2a"><b>|</b></font><font color="#6a5acd">&nbsp;egrep </font><font color="#a52a2a"><b>'</b></font><font color="#ff00ff">^AN</font><font color="#a52a2a"><b>'</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$SEND_ALERT</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;1&quot;</font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;_SendAlert <font color="#a020f0">$check</font>&nbsp;unknown <font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">error</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Nagios return code: unknown error</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>;;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># print the check (function) source code</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mysource <font color="#a52a2a"><b>)</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sed -n <font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">/^</font><font color="#a020f0">$2</font><font color="#ff00ff">&nbsp;</font><font color="#6a5acd">\(</font><font color="#6a5acd">\)</font><font color="#ff00ff">/,/^} *$/p</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a020f0">$0</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>exit</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>;;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># there is no default tool</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>esac</b></font><br>
<font color="#008b8b">}</font><br>
<br>
<font color="#0000ff"># debug function</font><br>
<font color="#008b8b">_Debug ()</font><br>
<font color="#008b8b">{</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># return if debug is disabled</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$DEBUG</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>!=</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#a52a2a"><b>return</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">prefix</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">---- DEBUG</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>if </b></font><font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$COLOR_DEBUG</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;1&quot;</font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>then</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># INFO: some OS, like AIX there is no echo -e option</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># so, maybe you may have to remove it</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><font color="#ff00ff">&nbsp;-e </font><font color="#a52a2a"><b>&quot;</b></font><font color="#6a5acd">\033</font><font color="#ff00ff">[32;1m </font><font color="#a020f0">$prefix</font><font color="#ff00ff">&nbsp;</font><font color="#a020f0">$*</font><font color="#ff00ff">&nbsp;</font><font color="#6a5acd">\033</font><font color="#ff00ff">[m</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>else</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$prefix</font><font color="#ff00ff">&nbsp;</font><font color="#a020f0">$*</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>fi</b></font><br>
<font color="#008b8b">}</font><br>
<br>
<font color="#0000ff"># show the functions help</font><br>
<font color="#008b8b">_ShowHelp ()</font><br>
<font color="#008b8b">{</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;local help critical warning<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># the help is the comments above the function (check) code</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># this sed gets those lines</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># $2 = check</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">help</font>=<span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">sed -n </font><font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">/^$/{</font><br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x</font><br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s/.*//</font><br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x</font><br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b</font><br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</font><br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/^</font><font color="#a020f0">$2</font><font color="#ff00ff">&nbsp;()/{</font><br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x</font><br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p</font><br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</font><br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;H</font><font color="#a52a2a"><b>&quot;</b></font><font color="#6a5acd">&nbsp;</font><font color="#a020f0">$0</font><font color="#6a5acd">&nbsp;</font><font color="#a52a2a"><b>|</b></font><br>
<font color="#6a5acd">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sed -n </font><font color="#a52a2a"><b>'</b></font><font color="#ff00ff">/^# --/d</font><br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s/^# \{0,1\}//p</font><font color="#a52a2a"><b>'</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># get the variable name that have the critical threshold for the check</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">critical</font>=<span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">echo </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$help</font><font color="#a52a2a"><b>&quot;</b></font><font color="#6a5acd">&nbsp;</font><font color="#a52a2a"><b>|</b></font><br>
<font color="#6a5acd">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sed -n </font><font color="#a52a2a"><b>'</b></font><font color="#ff00ff">s/.*critical\.: *</font><font color="#6a5acd">\(</font><font color="#ff00ff">[^ ]*</font><font color="#6a5acd">\)</font><font color="#ff00ff">.*/\1/p</font><font color="#a52a2a"><b>'</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># get the variable name that have the warning threshold for the check</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">warning</font>=<span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">echo </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$help</font><font color="#a52a2a"><b>&quot;</b></font><font color="#6a5acd">&nbsp;</font><font color="#a52a2a"><b>|</b></font><br>
<font color="#6a5acd">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sed -n </font><font color="#a52a2a"><b>'</b></font><font color="#ff00ff">s/.*warning\.\.: *</font><font color="#6a5acd">\(</font><font color="#ff00ff">[^ ]*</font><font color="#6a5acd">\)</font><font color="#ff00ff">.*/\1/p</font><font color="#a52a2a"><b>'</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># this &quot;ugly&quot; code gets the value (threshold) stored in the variable name</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># so, the help (tsmmonitor check --help) shows the default threshold that</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># is defined in the source code and not the variable name</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$help</font><font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>|</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sed <font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">s/: *</font><font color="#a020f0">${</font><font color="#a020f0">critical</font><font color="#a52a2a"><b>:-</b></font><span style="background-color: #ff0000"><font color="#ffffff">@@@</font></span><font color="#a020f0">}</font><font color="#ff00ff">/: </font><span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#a52a2a"><b>eval</b></font><font color="#6a5acd">&nbsp;echo </font><font color="#6a5acd">\$</font><font color="#a020f0">$critical</font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><font color="#ff00ff">/</font><br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s/: *</font><font color="#a020f0">${</font><font color="#a020f0">warning</font><font color="#a52a2a"><b>:-</b></font><span style="background-color: #ff0000"><font color="#ffffff">@@@</font></span><font color="#a020f0">}</font><font color="#ff00ff">/: </font><span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#a52a2a"><b>eval</b></font><font color="#6a5acd">&nbsp;echo </font><font color="#6a5acd">\$</font><font color="#a020f0">$warning</font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><font color="#ff00ff">/</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><br>
<font color="#008b8b">}</font><br>
<br>
<font color="#0000ff"># if necessary, send an alert (only when there is a check status change)</font><br>
<font color="#0000ff"># $1 - check name</font><br>
<font color="#0000ff"># $* - notification message</font><br>
<font color="#008b8b">_SendAlert ()</font><br>
<font color="#008b8b">{</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;local logfile oldstatus i<br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">check</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">newstatus</font>=<span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">echo </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$*</font><font color="#a52a2a"><b>&quot;</b></font><font color="#6a5acd">&nbsp;</font><font color="#a52a2a"><b>|</b></font><br>
<font color="#6a5acd">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sed </font><font color="#a52a2a"><b>'</b></font><font color="#ff00ff">s/^[^,]*, *</font><font color="#6a5acd">\(</font><font color="#ff00ff">OK</font><font color="#6a5acd">\)</font><font color="#ff00ff">\{0,1\}</font><font color="#6a5acd">\(</font><font color="#ff00ff">Warning</font><font color="#6a5acd">\)</font><font color="#ff00ff">\{0,1\}</font><font color="#6a5acd">\(</font><font color="#ff00ff">Critical</font><font color="#6a5acd">\)</font><font color="#ff00ff">\{0,1\}.*/\1\2\3/</font><font color="#a52a2a"><b>'</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>shift</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">logfile</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$TEMPDIR</font><font color="#ff00ff">/</font><font color="#a020f0">$StatusFile</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;_Debug <font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Log file: </font><font color="#a020f0">$logfile</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># is It the first time?</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>-f</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$logfile</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>||</b></font>&nbsp;<font color="#a52a2a"><b>echo</b></font><font color="#ff00ff">&nbsp;OK </font><font color="#a52a2a"><b>&gt;</b></font>&nbsp;<font color="#a020f0">$logfile</font>&nbsp;<font color="#0000ff"># is It the first time?</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Get the current status</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">oldstatus</font>=<font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">&lt;</font><font color="#a020f0">$logfile</font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Debug</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;_Debug <font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">oldstatus = </font><font color="#a020f0">$oldstatus</font><font color="#ff00ff">, newstatus = </font><font color="#a020f0">$newstatus</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>if </b></font><font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$oldstatus</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>!=</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$newstatus</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>]</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>then</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># save new status</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$newstatus</font><font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&gt;</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$logfile</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#0000ff"># save new status</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># do not send OK alert to sched check. this do not make sense?!</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$check</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;sched:&quot;</font>&nbsp;<font color="#a52a2a"><b>-a</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$newstatus</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;OK&quot;</font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#a52a2a"><b>return</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_Debug <font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Sending notification to </font><font color="#a020f0">$MAILTO</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Send e-mails</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>for </b></font>i <font color="#a52a2a"><b>in</b></font>&nbsp;<font color="#a020f0">$MAILTO</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>do</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">check </font><font color="#a020f0">$check</font><font color="#ff00ff">&nbsp;</font><font color="#a020f0">$*</font><font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>|</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mail <font color="#a52a2a"><b>-s</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">tsmmonitor: check </font><font color="#a020f0">$check</font><font color="#ff00ff">&nbsp;</font><font color="#a020f0">$newstatus</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$i</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>done</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>fi</b></font><br>
<font color="#008b8b">}</font><br>
<br>
<font color="#0000ff">##############################################################################</font><br>
<br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#0000ff"># #### yeah tsm checks.</font><br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
&nbsp;<br>
<br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#0000ff"># show all checks help</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># Usage..: tsmmonitor help</font><br>
<font color="#0000ff"># Example: tsmmonitor help</font><br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#008b8b">help ()</font><br>
<font color="#008b8b">{</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;--help&quot;</font>&nbsp;<font color="#a52a2a"><b>-o</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;-h&quot;</font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#6a5acd">{</font>&nbsp;_ShowHelp <font color="#a020f0">$0</font>&nbsp;help<font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#a52a2a"><b>return</b></font><font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#6a5acd">}</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;local check<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># for each check, execute tsmmonitor check --help</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>for </b></font>check <font color="#a52a2a"><b>in</b></font>&nbsp;<span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">sed -n </font><font color="#a52a2a"><b>'</b></font><font color="#ff00ff">s/^</font><font color="#6a5acd">\(</font><font color="#ff00ff">[a-zA-Z]*</font><font color="#6a5acd">\)</font><font color="#ff00ff">&nbsp;().*/\1/p</font><font color="#a52a2a"><b>'</b></font><font color="#6a5acd">&nbsp;</font><font color="#a020f0">$0</font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>do</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>'</b></font><font color="#ff00ff">---------------------------------------------------------------------</font><font color="#a52a2a"><b>'</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a020f0">$0</font>&nbsp;<font color="#a020f0">$check</font>&nbsp;--help <font color="#a52a2a"><b>|</b></font>&nbsp;sed <font color="#a52a2a"><b>'</b></font><font color="#ff00ff">1d;$d</font><font color="#a52a2a"><b>'</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>done</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>'</b></font><font color="#ff00ff">---------------------------------------------------------------------</font><font color="#a52a2a"><b>'</b></font><br>
<font color="#008b8b">}</font><br>
<br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#0000ff"># check tsm database utilization</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># The default percentages are:</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;warning..: DB_WARNING</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;critical.: DB_CRITICAL</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># Usage..: tsmmonitor db [options] [warning] [critical]</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">#&nbsp;&nbsp; -v6 check database utilization for TSM version 6</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># Example: tsmmonitor db</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor db 80 95</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor db -v6 80 90</font><br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#008b8b">db ()</font><br>
<font color="#008b8b">{</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;--help&quot;</font>&nbsp;<font color="#a52a2a"><b>-o</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;-h&quot;</font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#6a5acd">{</font>&nbsp;_ShowHelp <font color="#a020f0">$0</font>&nbsp;db<font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#a52a2a"><b>return</b></font><font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#6a5acd">}</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;local tsm_output pct_utl<br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">OK</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">sql</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">SELECT pct_utilized FROM db</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># options parser</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>case</b></font>&nbsp;<font color="#a020f0">$1</font>&nbsp;<font color="#a52a2a"><b>in</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-v6 <font color="#a52a2a"><b>)</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">sql</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">SELECT CAST(SUM(100-(free_space_mb*100) / tot_file_system_mb) \</font><br>
<font color="#ff00ff">AS DECIMAL(3,1)) AS PCT_UTILIZED FROM db</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>shift</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>;;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>esac</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Test if the parameters are numbers</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>if </b></font><font color="#a52a2a"><b>!</b></font>&nbsp;_tsmmonitor_tool is_number <font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$2</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>then</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Error: tsmmonitor db: invalid option -- '</font><font color="#a020f0">$1</font><font color="#ff00ff">' or '</font><font color="#a020f0">$2</font><font color="#ff00ff">'</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>fi</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Run the select statement</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">tsm_output</font>=<font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">_tsmmonitor_tool run_select db </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$sql</font><font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>||</b></font>&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">pct_utl</font>=<font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">echo </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$tsm_output</font><font color="#a52a2a"><b>&quot;</b></font><font color="#6a5acd">&nbsp;</font><font color="#a52a2a"><b>|</b></font><br>
<font color="#6a5acd">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sed -n </font><font color="#a52a2a"><b>'</b></font><font color="#ff00ff">s/^</font><font color="#6a5acd">\(</font><font color="#ff00ff">[0-9]\{1,\}</font><font color="#6a5acd">\)</font><font color="#ff00ff">[,.]*[0-9]*$/\1/p</font><font color="#a52a2a"><b>'</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># find out the current check status (ok/warning/critical)</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$pct_utl</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>-ge</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">1</font><font color="#a52a2a"><b>:-</b></font><font color="#a020f0">$DB_WARNING</font><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Warning</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$pct_utl</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>-ge</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">2</font><font color="#a52a2a"><b>:-</b></font><font color="#a020f0">$DB_CRITICAL</font><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Critical</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;_tsmmonitor_tool myecho db <font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">database utilization </font><font color="#a020f0">$pct_utl</font><font color="#ff00ff">%, </font><font color="#a020f0">$status</font><font color="#a52a2a"><b>&quot;</b></font><br>
<font color="#008b8b">}</font><br>
<br>
<br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#0000ff"># check tsm recovery log utilization</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># The default percentages are:</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;warning..: LOG_WARNING</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;critical.: LOG_CRITICAL</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># Usage..: tsmmonitor log [options] [warning] [critical]</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">#&nbsp;&nbsp; -v6 check active log utilization for TSM version 6</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># Example: tsmmonitor log</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor log 80 95</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor log -v6 70 80</font><br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#008b8b">log ()</font><br>
<font color="#008b8b">{</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;--help&quot;</font>&nbsp;<font color="#a52a2a"><b>-o</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;-h&quot;</font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#6a5acd">{</font>&nbsp;_ShowHelp <font color="#a020f0">$0</font>&nbsp;log<font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#a52a2a"><b>return</b></font><font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#6a5acd">}</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;local tsm_output pct_utl<br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">OK</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">sql</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">SELECT pct_utilized FROM log</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># options parser</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>case</b></font>&nbsp;<font color="#a020f0">$1</font>&nbsp;<font color="#a52a2a"><b>in</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-v6 <font color="#a52a2a"><b>)</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">sql</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">SELECT CAST(SUM(used_space_mb *100 / total_space_MB) AS \</font><br>
<font color="#ff00ff">DECIMAL(3,1)) AS MAX_PCT_UTILIZED FROM log</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>shift</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>;;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>esac</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Test if the parameters are numbers</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>if </b></font><font color="#a52a2a"><b>!</b></font>&nbsp;_tsmmonitor_tool is_number <font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$2</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>then</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Error: tsmmonitor log: invalid option -- '</font><font color="#a020f0">$1</font><font color="#ff00ff">' or '</font><font color="#a020f0">$2</font><font color="#ff00ff">'</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>fi</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Run the select statement</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">tsm_output</font>=<font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">_tsmmonitor_tool run_select log </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$sql</font><font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>||</b></font>&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">pct_utl</font>=<font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">echo </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$tsm_output</font><font color="#a52a2a"><b>&quot;</b></font><font color="#6a5acd">&nbsp;</font><font color="#a52a2a"><b>|</b></font><br>
<font color="#6a5acd">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sed -n </font><font color="#a52a2a"><b>'</b></font><font color="#ff00ff">s/^</font><font color="#6a5acd">\(</font><font color="#ff00ff">[0-9]\{1,\}</font><font color="#6a5acd">\)</font><font color="#ff00ff">[,.]*[0-9]*$/\1/p</font><font color="#a52a2a"><b>'</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$pct_utl</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>-ge</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">1</font><font color="#a52a2a"><b>:-</b></font><font color="#a020f0">$LOG_WARNING</font><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Warning</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$pct_utl</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>-ge</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">2</font><font color="#a52a2a"><b>:-</b></font><font color="#a020f0">$LOG_CRITICAL</font><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Critical</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;_tsmmonitor_tool myecho log <font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">log utilization </font><font color="#a020f0">$pct_utl</font><font color="#ff00ff">%, </font><font color="#a020f0">$status</font><font color="#a52a2a"><b>&quot;</b></font><br>
<font color="#008b8b">}</font><br>
<br>
<br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#0000ff"># check number of scratch tapes</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># The default numbers are:</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;warning..: SC_WARNING</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;critical.: SC_CRITICAL</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># Usage..: tsmmonitor scratch [options] [warning] [critical]</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">#&nbsp;&nbsp;-l, --library=LIBRARY_NAME&nbsp;&nbsp; check for scratch in the library only</font><br>
<font color="#0000ff"># </font><br>
<font color="#0000ff"># Example: tsmmonitor scratch</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor scratch 8 4</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor scratch -l=LTOLIB3 8 4</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor scratch -l=LTOLIB3</font><br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#008b8b">scratch ()</font><br>
<font color="#008b8b">{</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;--help&quot;</font>&nbsp;<font color="#a52a2a"><b>-o</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;-h&quot;</font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#6a5acd">{</font>&nbsp;_ShowHelp <font color="#a020f0">$0</font>&nbsp;scratch<font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#a52a2a"><b>return</b></font><font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#6a5acd">}</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;local tsm_output num_scratch library<br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">OK</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">sql</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">SELECT count(*) FROM libvolumes WHERE status='Scratch'</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># options parser</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>case</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>in</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-l=* <font color="#a52a2a"><b>|</b></font>&nbsp;--library=* <font color="#a52a2a"><b>)</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">library</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">1</font><span style="background-color: #ff0000"><font color="#ffffff">#*=</font></span><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># library is specified, so change the sql statement</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">sql</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$sql</font><font color="#ff00ff">&nbsp;AND library_name='</font><font color="#a020f0">$library</font><font color="#ff00ff">'</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">library</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">in library </font><font color="#a020f0">$library</font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>shift</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>;;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>esac</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Test if the parameters are numbers</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>if </b></font><font color="#a52a2a"><b>!</b></font>&nbsp;_tsmmonitor_tool is_number <font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$2</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>then</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Error: tsmmonitor scratch: invalid option -- '</font><font color="#a020f0">$1</font><font color="#ff00ff">' or '</font><font color="#a020f0">$2</font><font color="#ff00ff">'</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>fi</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Run the select statement</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">tsm_output</font>=<font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">_tsmmonitor_tool run_select scratch </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$sql</font><font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>||</b></font>&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">num_scratch</font>=<span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">echo </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$tsm_output</font><font color="#a52a2a"><b>&quot;</b></font><font color="#6a5acd">&nbsp;</font><font color="#a52a2a"><b>|</b></font><font color="#6a5acd">&nbsp;sed -n </font><font color="#a52a2a"><b>'</b></font><font color="#ff00ff">/^ *[0-9]/p</font><font color="#a52a2a"><b>'</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$num_scratch</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>-le</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">1</font><font color="#a52a2a"><b>:-</b></font><font color="#a020f0">$SC_WARNING</font><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Warning</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$num_scratch</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>-le</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">2</font><font color="#a52a2a"><b>:-</b></font><font color="#a020f0">$SC_CRITICAL</font><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Critical</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;_tsmmonitor_tool myecho scratch <font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">number of scratch tapes </font><font color="#a020f0">$library$num_scratch</font><font color="#ff00ff">, </font><font color="#a020f0">$status</font><font color="#a52a2a"><b>&quot;</b></font><br>
<font color="#008b8b">}</font><br>
<br>
<br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#0000ff"># check number of drives not online</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># The default numbers are:</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;warning..: DRIVE_WARNING</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;critical.: DRIVE_CRITICAL</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># Usage..: tsmmonitor drive [options] [warning] [critical]</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">#&nbsp;&nbsp;-l, --library=LIBRARY_NAME&nbsp;&nbsp; check in the specific library only</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># Example: tsmmonitor drive</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor drive 2 3</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor drive -l=LTOLIB3 1 2</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor drive -l=LTOLIB3</font><br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#008b8b">drive ()</font><br>
<font color="#008b8b">{</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;--help&quot;</font>&nbsp;<font color="#a52a2a"><b>-o</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;-h&quot;</font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#6a5acd">{</font>&nbsp;_ShowHelp <font color="#a020f0">$0</font>&nbsp;drive<font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#a52a2a"><b>return</b></font><font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#6a5acd">}</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;local tsm_output num_drives library<br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">OK</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">sql</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">SELECT count(*) FROM drives WHERE NOT online='YES'</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># options parser</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>case</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>in</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-l=* <font color="#a52a2a"><b>|</b></font>&nbsp;--library=* <font color="#a52a2a"><b>)</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">library</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">1</font><span style="background-color: #ff0000"><font color="#ffffff">#*=</font></span><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">sql</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$sql</font><font color="#ff00ff">&nbsp;AND library_name='</font><font color="#a020f0">$library</font><font color="#ff00ff">'</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">library</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">in library </font><font color="#a020f0">$library</font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>shift</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>;;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>esac</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Test if the parameters are numbers</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>if </b></font><font color="#a52a2a"><b>!</b></font>&nbsp;_tsmmonitor_tool is_number <font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$2</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>then</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Error: tsmmonitor drive: invalid option -- '</font><font color="#a020f0">$1</font><font color="#ff00ff">' or '</font><font color="#a020f0">$2</font><font color="#ff00ff">'</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>fi</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Run the select statement</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">tsm_output</font>=<font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">_tsmmonitor_tool run_select drive </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$sql</font><font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>||</b></font>&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">num_drives</font>=<span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">echo </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$tsm_output</font><font color="#a52a2a"><b>&quot;</b></font><font color="#6a5acd">&nbsp;</font><font color="#a52a2a"><b>|</b></font><font color="#6a5acd">&nbsp;sed -n </font><font color="#a52a2a"><b>'</b></font><font color="#ff00ff">/^ *[0-9]/p</font><font color="#a52a2a"><b>'</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$num_drives</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>-ge</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">1</font><font color="#a52a2a"><b>:-</b></font><font color="#a020f0">$DRIVE_WARNING</font><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Warning</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$num_drives</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>-ge</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">2</font><font color="#a52a2a"><b>:-</b></font><font color="#a020f0">$DRIVE_CRITICAL</font><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Critical</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;_tsmmonitor_tool myecho drive <font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">number of drives not online </font><font color="#a020f0">$library$num_drives</font><font color="#ff00ff">, </font><font color="#a020f0">$status</font><font color="#a52a2a"><b>&quot;</b></font><br>
<font color="#008b8b">}</font><br>
<br>
<br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#0000ff"># check number of paths not online</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># The default numbers are:</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;warning..: PATH_WARNING</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;critical.: PATH_CRITICAL</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># Usage..: tsmmonitor path [options] [warning] [critical]</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># -s, --source=SOURCE_NAME&nbsp;&nbsp; check path with a specific source name</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># Example: tsmmonitor path</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor path 2 4</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor path -s=LANFREE1 1 4</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor path -s=LANFREE1</font><br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#008b8b">path ()</font><br>
<font color="#008b8b">{</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;--help&quot;</font>&nbsp;<font color="#a52a2a"><b>-o</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;-h&quot;</font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#6a5acd">{</font>&nbsp;_ShowHelp <font color="#a020f0">$0</font>&nbsp;path<font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#a52a2a"><b>return</b></font><font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#6a5acd">}</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;local tsm_output num_paths source<br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">OK</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">sql</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">SELECT count(*) FROM paths WHERE NOT online='YES'</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># options parser</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>case</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>in</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-s=* <font color="#a52a2a"><b>|</b></font>&nbsp;--source=* <font color="#a52a2a"><b>)</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">source</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">1</font><span style="background-color: #ff0000"><font color="#ffffff">#*=</font></span><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">sql</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$sql</font><font color="#ff00ff">&nbsp;AND source_name='</font><font color="#a020f0">$source</font><font color="#ff00ff">'</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">source</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">with source name </font><font color="#a020f0">$source</font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>shift</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>;;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>esac</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Test if the parameters are numbers</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>if </b></font><font color="#a52a2a"><b>!</b></font>&nbsp;_tsmmonitor_tool is_number <font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$2</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>then</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Error: tsmmonitor path: invalid option -- '</font><font color="#a020f0">$1</font><font color="#ff00ff">' or '</font><font color="#a020f0">$2</font><font color="#ff00ff">'</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>fi</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Run the select statement</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">tsm_output</font>=<font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">_tsmmonitor_tool run_select path </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$sql</font><font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>||</b></font>&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">num_paths</font>=<span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">echo </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$tsm_output</font><font color="#a52a2a"><b>&quot;</b></font><font color="#6a5acd">&nbsp;</font><font color="#a52a2a"><b>|</b></font><font color="#6a5acd">&nbsp;sed -n </font><font color="#a52a2a"><b>'</b></font><font color="#ff00ff">/^ *[0-9]/p</font><font color="#a52a2a"><b>'</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$num_paths</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>-ge</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">1</font><font color="#a52a2a"><b>:-</b></font><font color="#a020f0">$PATH_WARNING</font><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Warning</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$num_paths</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>-ge</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">2</font><font color="#a52a2a"><b>:-</b></font><font color="#a020f0">$PATH_CRITICAL</font><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Critical</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;_tsmmonitor_tool myecho path <font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">number of paths not online </font><font color="#a020f0">$source$num_paths</font><font color="#ff00ff">, </font><font color="#a020f0">$status</font><font color="#a52a2a"><b>&quot;</b></font><br>
<font color="#008b8b">}</font><br>
<br>
<br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#0000ff"># check tsm database fragmentation</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># The default numbers are:</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;warning..: DBFRAG_WARNING</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;critical.: DBFRAG_CRITICAL</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># Usage..: tsmmonitor dbfrag [warning] [critical]</font><br>
<font color="#0000ff"># Example: tsmmonitor dbfrag</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor dbfrag 50 75</font><br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#008b8b">dbfrag ()</font><br>
<font color="#008b8b">{</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;--help&quot;</font>&nbsp;<font color="#a52a2a"><b>-o</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;-h&quot;</font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#6a5acd">{</font>&nbsp;_ShowHelp <font color="#a020f0">$0</font>&nbsp;dbfrag<font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#a52a2a"><b>return</b></font><font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#6a5acd">}</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;local tsm_output pct<br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">OK</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">sql</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">SELECT CAST((100 - (CAST(MAX_REDUCTION_MB AS FLOAT) * 256 ) /</font><br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(CAST(USABLE_PAGES AS FLOAT) - CAST(USED_PAGES AS FLOAT) ) * 100) AS</font><br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DECIMAL(4,2)) AS PERCENT_FRAG FROM DB</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Test if the parameters are numbers</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>if </b></font><font color="#a52a2a"><b>!</b></font>&nbsp;_tsmmonitor_tool is_number <font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$2</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>then</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Error: tsmmonitor dbfrag: invalid option -- '</font><font color="#a020f0">$1</font><font color="#ff00ff">' or '</font><font color="#a020f0">$2</font><font color="#ff00ff">'</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>fi</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Run the select statement</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">tsm_output</font>=<font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">_tsmmonitor_tool run_select dbfrag </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$sql</font><font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>||</b></font>&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">pct</font>=<span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">echo </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$tsm_output</font><font color="#a52a2a"><b>&quot;</b></font><font color="#6a5acd">&nbsp;</font><font color="#a52a2a"><b>|</b></font><font color="#6a5acd">&nbsp;sed -n </font><font color="#a52a2a"><b>'</b></font><font color="#ff00ff">/^[0-9-]/s/[.,].*//p</font><font color="#a52a2a"><b>'</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$pct</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>-ge</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">1</font><font color="#a52a2a"><b>:-</b></font><font color="#a020f0">$DBFRAG_WARNING</font><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Warning</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$pct</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>-ge</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">2</font><font color="#a52a2a"><b>:-</b></font><font color="#a020f0">$DBFRAG_CRITICAL</font><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Critical</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;_tsmmonitor_tool myecho dbfrag <font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">database fragmentation </font><font color="#a020f0">$pct</font><font color="#ff00ff">%, </font><font color="#a020f0">$status</font><font color="#a52a2a"><b>&quot;</b></font><br>
<font color="#008b8b">}</font><br>
<br>
<br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#0000ff"># check number of unavailable volumes</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># The default numbers are:</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;warning..: UNAV_WARNING</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;critical.: UNAV_CRITICAL</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># Usage..: tsmmonitor unav [options] [warning] [critical]</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># -d, --deviceclass=DEVICE_CLASS&nbsp;&nbsp; check only in a specific device class </font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># Example: tsmmonitor unav</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor unav 2 4</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor unav -d=LTOCLASS 2 4</font><br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#008b8b">unav ()</font><br>
<font color="#008b8b">{</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;--help&quot;</font>&nbsp;<font color="#a52a2a"><b>-o</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;-h&quot;</font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#6a5acd">{</font>&nbsp;_ShowHelp <font color="#a020f0">$0</font>&nbsp;unav<font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#a52a2a"><b>return</b></font><font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#6a5acd">}</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;local tsm_output num_vol devclass<br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">OK</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">sql</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">SELECT count(*) FROM volumes WHERE access='UNAVAILABLE'</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># options parser</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>case</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>in</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-d=* <font color="#a52a2a"><b>|</b></font>&nbsp;--deviceclass=* <font color="#a52a2a"><b>)</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">devclass</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">1</font><span style="background-color: #ff0000"><font color="#ffffff">#*=</font></span><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">sql</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$sql</font><font color="#ff00ff">&nbsp;AND devclass_name='</font><font color="#a020f0">$devclass</font><font color="#ff00ff">'</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">devclass</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">in device class </font><font color="#a020f0">$devclass</font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>shift</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>;;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>esac</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Test if the parameters are numbers</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>if </b></font><font color="#a52a2a"><b>!</b></font>&nbsp;_tsmmonitor_tool is_number <font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$2</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>then</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Error: tsmmonitor unav: invalid option -- '</font><font color="#a020f0">$1</font><font color="#ff00ff">' or '</font><font color="#a020f0">$2</font><font color="#ff00ff">'</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>fi</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Run the select statement</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">tsm_output</font>=<font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">_tsmmonitor_tool run_select unav </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$sql</font><font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>||</b></font>&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Number of unavailable volumes</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">num_vol</font>=<span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">echo </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$tsm_output</font><font color="#a52a2a"><b>&quot;</b></font><font color="#6a5acd">&nbsp;</font><font color="#a52a2a"><b>|</b></font><font color="#6a5acd">&nbsp;sed -n </font><font color="#a52a2a"><b>'</b></font><font color="#ff00ff">/^[0-9][0-9]*$/p</font><font color="#a52a2a"><b>'</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span>&nbsp;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$num_vol</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>-ge</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">1</font><font color="#a52a2a"><b>:-</b></font><font color="#a020f0">$UNAV_WARNING</font><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Warning</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$num_vol</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>-ge</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">2</font><font color="#a52a2a"><b>:-</b></font><font color="#a020f0">$UNAV_CRITICAL</font><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Critical</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;_tsmmonitor_tool myecho unav <font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">number of unavailable volumes </font><font color="#a020f0">$devclass$num_vol</font><font color="#ff00ff">, </font><font color="#a020f0">$status</font><font color="#a52a2a"><b>&quot;</b></font><br>
<font color="#008b8b">}</font><br>
<br>
<br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#0000ff"># check a storage pool utilization</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># The default numbers are:</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;warning..: STGPOOL_WARNING</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;critical.: STGPOOL_CRITICAL</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># Usage..: tsmmonitor stgpool &lt;storage_pool_name&gt; [warning] [critical]</font><br>
<font color="#0000ff"># Example: tsmmonitor stgpool DISK_POOL</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor stgpool DISK_POOL 50 75</font><br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#008b8b">stgpool ()</font><br>
<font color="#008b8b">{</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;--help&quot;</font>&nbsp;<font color="#a52a2a"><b>-o</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;-h&quot;</font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#6a5acd">{</font>&nbsp;_ShowHelp <font color="#a020f0">$0</font>&nbsp;stgpool<font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#a52a2a"><b>return</b></font><font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#6a5acd">}</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;local tsm_output pct_utl<br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">OK</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">sql</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">SELECT pct_utilized FROM stgpools WHERE stgpool_name='</font><font color="#a020f0">$1</font><font color="#ff00ff">'</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># The user must specify the storage pool</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>if </b></font><font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>!</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>]</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>then</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Error: tsmmonitor stgpool: You must specify a storage pool name.</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>fi</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Test if the parameters are numbers</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>if </b></font><font color="#a52a2a"><b>!</b></font>&nbsp;_tsmmonitor_tool is_number <font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$2</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$3</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>then</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Error: tsmmonitor stgpool: invalid option -- '</font><font color="#a020f0">$2</font><font color="#ff00ff">' or '</font><font color="#a020f0">$3</font><font color="#ff00ff">'</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>fi</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Run the select statement</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">tsm_output</font>=<font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">_tsmmonitor_tool run_select stgpool </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$sql</font><font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>||</b></font>&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">pct_utl</font>=<span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">echo </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$tsm_output</font><font color="#a52a2a"><b>&quot;</b></font><font color="#6a5acd">&nbsp;</font><font color="#a52a2a"><b>|</b></font><font color="#6a5acd">&nbsp;sed -n </font><font color="#a52a2a"><b>'</b></font><font color="#ff00ff">/^[0-9]/s/[.,].*//p</font><font color="#a52a2a"><b>'</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$pct_utl</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>-ge</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">2</font><font color="#a52a2a"><b>:-</b></font><font color="#a020f0">$STGPOOL_WARNING</font><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Warning</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$pct_utl</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>-ge</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">3</font><font color="#a52a2a"><b>:-</b></font><font color="#a020f0">$STGPOOL_CRITICAL</font><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Critical</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;_tsmmonitor_tool myecho stgpool <font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">utilization of storage pool </font><font color="#a020f0">$1</font><font color="#ff00ff">&nbsp;</font><font color="#a020f0">$pct_utl</font><font color="#ff00ff">%, </font><font color="#a020f0">$status</font><font color="#a52a2a"><b>&quot;</b></font><br>
<font color="#008b8b">}</font><br>
<br>
<br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#0000ff"># check for volumes with write error and/or read error</font><br>
<font color="#0000ff"># </font><br>
<font color="#0000ff"># Default, search for volumes with write or read errors</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># The default numbers are:</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;warning..: VOLERR_WARNING</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;critical.: VOLERR_CRITICAL</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># Usage..: tsmmonitor volerr [options] [warning] [critical]</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;-r, --read&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; test only read errors</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;-w, --write&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;test only write errors</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;-l, --library=LIBRARY_NAME&nbsp;&nbsp; check only volumes in the library</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># Example: tsmmonitor volerr</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor volerr -r</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor volerr 3 5</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor volerr -l=LTOLIB</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor volerr -l=LTOLIB 3 5</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor volerr -w -l=LTOLIB 3 5</font><br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#008b8b">volerr ()</font><br>
<font color="#008b8b">{</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;--help&quot;</font>&nbsp;<font color="#a52a2a"><b>-o</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;-h&quot;</font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#6a5acd">{</font>&nbsp;_ShowHelp <font color="#a020f0">$0</font>&nbsp;volerr<font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#a52a2a"><b>return</b></font><font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#6a5acd">}</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;local tsm_output num_vol library<br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">OK</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">sql_vol_err</font>=<font color="#a52a2a"><b>'</b></font><font color="#ff00ff">( WRITE_ERRORS&gt;0 OR READ_ERRORS&gt;0 )</font><font color="#a52a2a"><b>'</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">sql_lib</font>=<font color="#a52a2a"><b>'</b></font><font color="#ff00ff">volume_name IN ( SELECT volume_name FROM libvolumes WHERE library_name=</font><font color="#a52a2a"><b>'</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">sql</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">SELECT count(*) FROM volumes WHERE</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># parsing options</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;while <font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>]</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>do</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>case</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>in</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-r <font color="#a52a2a"><b>|</b></font>&nbsp;--read&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>)</b></font>&nbsp;<font color="#008b8b">sql_vol_err</font>=<font color="#a52a2a"><b>'</b></font><font color="#ff00ff">READ_ERRORS&gt;0</font><font color="#a52a2a"><b>'</b></font>&nbsp;&nbsp;<font color="#a52a2a"><b>;;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-w <font color="#a52a2a"><b>|</b></font>&nbsp;--write&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#a52a2a"><b>)</b></font>&nbsp;<font color="#008b8b">sql_vol_err</font>=<font color="#a52a2a"><b>'</b></font><font color="#ff00ff">WRITE_ERRORS&gt;0</font><font color="#a52a2a"><b>'</b></font>&nbsp;<font color="#a52a2a"><b>;;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-l=* <font color="#a52a2a"><b>|</b></font>&nbsp;--library=* <font color="#a52a2a"><b>)</b></font>&nbsp;<font color="#008b8b">library</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">1</font><span style="background-color: #ff0000"><font color="#ffffff">#*=</font></span><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>;;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>)</b></font>&nbsp;<font color="#a52a2a"><b>break</b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>;;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>esac</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>shift</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>done</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># define the correct sql statement</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>if </b></font><font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$library</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>]</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>then</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">sql</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$sql</font><font color="#ff00ff">&nbsp;</font><font color="#a020f0">$sql_vol_err</font><font color="#ff00ff">&nbsp;AND </font><font color="#a020f0">$sql_lib</font><font color="#ff00ff">'</font><font color="#a020f0">$library</font><font color="#ff00ff">' )</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">library</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">in library </font><font color="#a020f0">$library</font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>else</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">sql</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$sql</font><font color="#ff00ff">&nbsp;</font><font color="#a020f0">$sql_vol_err</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>fi</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Test if the parameters are numbers</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>if </b></font><font color="#a52a2a"><b>!</b></font>&nbsp;_tsmmonitor_tool is_number <font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$2</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>then</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Error: tsmmonitor volerr: invalid option -- '</font><font color="#a020f0">$1</font><font color="#ff00ff">' or '</font><font color="#a020f0">$2</font><font color="#ff00ff">'</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>fi</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Run the select statement</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">tsm_output</font>=<font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">_tsmmonitor_tool run_select volerr </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$sql</font><font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>||</b></font>&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Number of volumes</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">num_vol</font>=<span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">echo </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$tsm_output</font><font color="#a52a2a"><b>&quot;</b></font><font color="#6a5acd">&nbsp;</font><font color="#a52a2a"><b>|</b></font><font color="#6a5acd">&nbsp;sed -n </font><font color="#a52a2a"><b>'</b></font><font color="#ff00ff">/^[0-9][0-9]*$/p</font><font color="#a52a2a"><b>'</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># check the status</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$num_vol</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>-ge</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">1</font><font color="#a52a2a"><b>:-</b></font><font color="#a020f0">$VOLERR_WARNING</font><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Warning</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$num_vol</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>-ge</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">2</font><font color="#a52a2a"><b>:-</b></font><font color="#a020f0">$VOLERR_CRITICAL</font><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Critical</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;_tsmmonitor_tool myecho volerr <font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">number of volumes </font><font color="#a020f0">${</font><font color="#a020f0">library</font><font color="#a020f0">}</font><font color="#ff00ff">with error </font><font color="#a020f0">$num_vol</font><font color="#ff00ff">, </font><font color="#a020f0">$status</font><font color="#a52a2a"><b>&quot;</b></font><br>
<font color="#008b8b">}</font><br>
<br>
<br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#0000ff"># check for volumes with percentage reclaimable space greater than </font><br>
<font color="#0000ff"># </font><br>
<font color="#0000ff"># The default numbers are:</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;warning..: VOLRECL_WARNING</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;critical.: VOLRECL_CRITICAL</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># Usage..: tsmmonitor volreclaim [options] [warning] [critical]</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;-r, --reclaim=PCT_RECLAIM&nbsp;&nbsp;&nbsp;&nbsp;pct reclaimable space (default: 80 pct)</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;-l, --library=LIBRARY_NAME&nbsp;&nbsp; check only volumes in the library</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;-s, --stgpool=STGPOOL_NAME&nbsp;&nbsp; check only volumes in the storage pool</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;-V, --verbose&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list the volumes found</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># Example: tsmmonitor volreclaim</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor volreclaim -r</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor volreclaim 3 5</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor volreclaim -l=LTOLIB</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor volreclaim -l=LTOLIB 3 5</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor volreclaim -w -l=LTOLIB 3 5</font><br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#008b8b">volreclaim ()</font><br>
<font color="#008b8b">{</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;--help&quot;</font>&nbsp;<font color="#a52a2a"><b>-o</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;-h&quot;</font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#6a5acd">{</font>&nbsp;_ShowHelp <font color="#a020f0">$0</font>&nbsp;volreclaim<font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#a52a2a"><b>return</b></font><font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#6a5acd">}</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;local tsm_output num_vol library stgpool verbose<br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">pct_reclaim</font>=<font color="#a52a2a"><b>'</b></font><font color="#ff00ff">80</font><font color="#a52a2a"><b>'</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">OK</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">sql_lib</font>=<font color="#a52a2a"><b>'</b></font><font color="#ff00ff">volume_name IN ( SELECT volume_name FROM libvolumes WHERE library_name=</font><font color="#a52a2a"><b>'</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">sql_list</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">volume_name,stgpool_name,pct_reclaim,status</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">sql</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">SELECT count(*) FROM volumes WHERE</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># parsing options</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;while <font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>]</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>do</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>case</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>in</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-r=* <font color="#a52a2a"><b>|</b></font>&nbsp;--reclaim=* <font color="#a52a2a"><b>)</b></font>&nbsp;<font color="#008b8b">pct_reclaim</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">1</font><span style="background-color: #ff0000"><font color="#ffffff">#*=</font></span><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>;;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-l=* <font color="#a52a2a"><b>|</b></font>&nbsp;--library=* <font color="#a52a2a"><b>)</b></font>&nbsp;<font color="#008b8b">library</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">1</font><span style="background-color: #ff0000"><font color="#ffffff">#*=</font></span><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;&nbsp;&nbsp;&nbsp; <font color="#a52a2a"><b>;;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-s=* <font color="#a52a2a"><b>|</b></font>&nbsp;--stgpool=* <font color="#a52a2a"><b>)</b></font>&nbsp;<font color="#008b8b">stgpool</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">1</font><span style="background-color: #ff0000"><font color="#ffffff">#*=</font></span><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;&nbsp;&nbsp;&nbsp; <font color="#a52a2a"><b>;;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-V&nbsp;&nbsp; <font color="#a52a2a"><b>|</b></font>&nbsp;--verbose&nbsp;&nbsp; <font color="#a52a2a"><b>)</b></font>&nbsp;<font color="#008b8b">verbose</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#a52a2a"><b>;;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>)</b></font>&nbsp;<font color="#a52a2a"><b>break</b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#a52a2a"><b>;;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>esac</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>shift</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>done</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">sql</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$sql</font><font color="#ff00ff">&nbsp;pct_reclaim&gt;</font><font color="#a020f0">$pct_reclaim</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># stgpool was specified</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>if </b></font><font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$stgpool</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>]</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>then</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">sql</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$sql</font><font color="#ff00ff">&nbsp;AND stgpool_name='</font><font color="#a020f0">$stgpool</font><font color="#ff00ff">'</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">stgpool</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">in stgpool </font><font color="#a020f0">$stgpool</font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>fi</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># library was specified</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>if </b></font><font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$library</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>]</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>then</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">sql</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$sql</font><font color="#ff00ff">&nbsp;AND </font><font color="#a020f0">$sql_lib</font><font color="#ff00ff">'</font><font color="#a020f0">$library</font><font color="#ff00ff">' )</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">library</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">in library </font><font color="#a020f0">$library</font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>fi</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># test the pct of reclaim</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>if </b></font><font color="#a52a2a"><b>!</b></font>&nbsp;_tsmmonitor_tool is_number <font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$pct_reclaim</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>then</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Error: tsmmonitor volreclaim: invalid percentage -- '</font><font color="#a020f0">$pct_reclaim</font><font color="#ff00ff">'</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>fi</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># test if the parameters are numbers</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>if </b></font><font color="#a52a2a"><b>!</b></font>&nbsp;_tsmmonitor_tool is_number <font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$2</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>then</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Error: tsmmonitor volreclaim: invalid option -- '</font><font color="#a020f0">$1</font><font color="#ff00ff">' or '</font><font color="#a020f0">$2</font><font color="#ff00ff">'</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>fi</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># run the select statement</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">tsm_output</font>=<font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">_tsmmonitor_tool run_select volreclaim </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$sql</font><font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>||</b></font>&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># number of volumes</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">num_vol</font>=<span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">echo </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$tsm_output</font><font color="#a52a2a"><b>&quot;</b></font><font color="#6a5acd">&nbsp;</font><font color="#a52a2a"><b>|</b></font><font color="#6a5acd">&nbsp;sed -n </font><font color="#a52a2a"><b>'</b></font><font color="#ff00ff">/^[0-9][0-9]*$/p</font><font color="#a52a2a"><b>'</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># check the status</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$num_vol</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>-ge</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">1</font><font color="#a52a2a"><b>:-</b></font><font color="#a020f0">$VOLRECL_WARNING</font><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Warning</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$num_vol</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>-ge</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">2</font><font color="#a52a2a"><b>:-</b></font><font color="#a020f0">$VOLRECL_CRITICAL</font><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Critical</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>if </b></font><font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$verbose</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;1&quot;</font>&nbsp;<font color="#a52a2a"><b>]</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>then</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">sql</font>=<span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">echo </font><font color="#a020f0">$sql</font><font color="#6a5acd">&nbsp;</font><font color="#a52a2a"><b>|</b></font><font color="#6a5acd">&nbsp;sed </font><font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">s/count(\*)/</font><font color="#a020f0">$sql_list</font><font color="#ff00ff">/</font><font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_tsmmonitor_tool run_select volreclaim <font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$sql</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>|</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sed <font color="#a52a2a"><b>-n</b></font>&nbsp;<font color="#a52a2a"><b>'</b></font><font color="#ff00ff">/ANS8000I/,/ANS8002I/p</font><font color="#a52a2a"><b>'</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>fi</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;_tsmmonitor_tool myecho volreclaim \<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">number of volumes pct.reclaim&gt;</font><font color="#a020f0">$pct_reclaim</font><font color="#ff00ff">&nbsp;</font><font color="#a020f0">$stgpool$library$num_vol</font><font color="#ff00ff">, </font><font color="#a020f0">$status</font><font color="#a52a2a"><b>&quot;</b></font><br>
<font color="#008b8b">}</font><br>
<br>
<br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#0000ff"># check how many tapes are in the library</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># The default numbers are:</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;warning..: TAPESLIB_WARNING</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;critical.: TAPESLIB_CRITICAL</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># Usage..: tsmmonitor tapeslib [options] [warning] [critical]</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;-l, --library=LIBRARY_NAME&nbsp;&nbsp; check only volumes in the library</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># Example: tsmmonitor tapeslib</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor tapeslib 120 115</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor tapeslib -l=LTOLIB3 120 115</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor tapeslib -l=LTOLIB3</font><br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#008b8b">tapeslib ()</font><br>
<font color="#008b8b">{</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;--help&quot;</font>&nbsp;<font color="#a52a2a"><b>-o</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;-h&quot;</font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#6a5acd">{</font>&nbsp;_ShowHelp <font color="#a020f0">$0</font>&nbsp;tapeslib<font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#a52a2a"><b>return</b></font><font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#6a5acd">}</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;local tsm_output num_tapes library<br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">OK</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">sql</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">SELECT count(*) FROM libvolumes</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># options parser</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>case</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>in</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-l=* <font color="#a52a2a"><b>|</b></font>&nbsp;--library=* <font color="#a52a2a"><b>)</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">library</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">1</font><span style="background-color: #ff0000"><font color="#ffffff">#*=</font></span><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">sql</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$sql</font><font color="#ff00ff">&nbsp;WHERE library_name='</font><font color="#a020f0">$library</font><font color="#ff00ff">'</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>shift</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>;;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>esac</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Test if the parameters are numbers</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>if </b></font><font color="#a52a2a"><b>!</b></font>&nbsp;_tsmmonitor_tool is_number <font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$2</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>then</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Error: tsmmonitor tapeslib: invalid option -- '</font><font color="#a020f0">$1</font><font color="#ff00ff">' or '</font><font color="#a020f0">$2</font><font color="#ff00ff">'</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>fi</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Run the select statement</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">tsm_output</font>=<font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">_tsmmonitor_tool run_select tapeslib </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$sql</font><font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>||</b></font>&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Number of tapes</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">num_tapes</font>=<span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">echo </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$tsm_output</font><font color="#a52a2a"><b>&quot;</b></font><font color="#6a5acd">&nbsp;</font><font color="#a52a2a"><b>|</b></font><font color="#6a5acd">&nbsp;sed -n </font><font color="#a52a2a"><b>'</b></font><font color="#ff00ff">/^[0-9]/p</font><font color="#a52a2a"><b>'</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$num_tapes</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>-le</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">1</font><font color="#a52a2a"><b>:-</b></font><font color="#a020f0">$TAPESLIB_WARNING</font><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Warning</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$num_tapes</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>-le</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">2</font><font color="#a52a2a"><b>:-</b></font><font color="#a020f0">$TAPESLIB_CRITICAL</font><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Critical</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;_tsmmonitor_tool myecho tapeslib <font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">number of tapes in the library </font><font color="#a020f0">$library</font><font color="#ff00ff">&nbsp;</font><font color="#a020f0">$num_tapes</font><font color="#ff00ff">, </font><font color="#a020f0">$status</font><font color="#a52a2a"><b>&quot;</b></font><br>
<font color="#008b8b">}</font><br>
<br>
<br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#0000ff"># check how many tapes have a specific owner</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># The default numbers are:</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;warning..: TAPESOWN_WARNING</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;critical.: TAPESOWN_CRITICAL</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># Usage..: tsmmonitor tapesown &lt;owner&gt; [warning] [critical]</font><br>
<font color="#0000ff"># Example: tsmmonitor tapesown tsmsrv01</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor tapesown tsmsrv01 4 5</font><br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#008b8b">tapesown ()</font><br>
<font color="#008b8b">{</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;--help&quot;</font>&nbsp;<font color="#a52a2a"><b>-o</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;-h&quot;</font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#6a5acd">{</font>&nbsp;_ShowHelp <font color="#a020f0">$0</font>&nbsp;tapesown<font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#a52a2a"><b>return</b></font><font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#6a5acd">}</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;local tsm_output num_tapes<br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">OK</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">sql</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">SELECT count(*) FROM libvolumes WHERE owner='</font><font color="#a020f0">$1</font><font color="#ff00ff">'</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># User must specify an owner</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>if </b></font><font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>!</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>]</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>then</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Error: tsmmonitor tapesown: You must specify an owner</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>fi</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Test if the parameters are numbers</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>if </b></font><font color="#a52a2a"><b>!</b></font>&nbsp;_tsmmonitor_tool is_number <font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$2</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$3</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>then</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Error: tsmmonitor tapesown: invalid option -- '</font><font color="#a020f0">$2</font><font color="#ff00ff">' or '</font><font color="#a020f0">$3</font><font color="#ff00ff">'</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>fi</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Run the select statement</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">tsm_output</font>=<font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">_tsmmonitor_tool run_select tapesown </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$sql</font><font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>||</b></font>&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Number of tapes</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">num_tapes</font>=<span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">echo </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$tsm_output</font><font color="#a52a2a"><b>&quot;</b></font><font color="#6a5acd">&nbsp;</font><font color="#a52a2a"><b>|</b></font><font color="#6a5acd">&nbsp;sed -n </font><font color="#a52a2a"><b>'</b></font><font color="#ff00ff">/^[0-9]/p</font><font color="#a52a2a"><b>'</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$num_tapes</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>-ge</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">2</font><font color="#a52a2a"><b>:-</b></font><font color="#a020f0">$TAPESOWN_WARNING</font><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Warning</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$num_tapes</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>-ge</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">3</font><font color="#a52a2a"><b>:-</b></font><font color="#a020f0">$TAPESOWN_CRITICAL</font><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Critical</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;_tsmmonitor_tool myecho tapesown <font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">number of tapes owner by </font><font color="#a020f0">$1</font><font color="#ff00ff">&nbsp;</font><font color="#a020f0">$num_tapes</font><font color="#ff00ff">, </font><font color="#a020f0">$status</font><font color="#a52a2a"><b>&quot;</b></font><br>
<font color="#008b8b">}</font><br>
<br>
<br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#0000ff"># check how many volumes are in a specific storage pool</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># The default numbers are:</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;warning..: TAPESSTGPOOL_WARNING</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;critical.: TAPESSTGPOOL_CRITICAL</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># Usage..: tsmmonitor tapesstgpool &lt;storage_pool_name&gt; [warning] [critical]</font><br>
<font color="#0000ff"># Example: tsmmonitor tapesstgpool DAILY</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor tapesstgpool DAILY 30 45</font><br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#008b8b">tapesstgpool ()</font><br>
<font color="#008b8b">{</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;--help&quot;</font>&nbsp;<font color="#a52a2a"><b>-o</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;-h&quot;</font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#6a5acd">{</font>&nbsp;_ShowHelp <font color="#a020f0">$0</font>&nbsp;tapesstgpool<font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#a52a2a"><b>return</b></font><font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#6a5acd">}</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;local tsm_output num_tapes<br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">sql</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">SELECT count(*) FROM volumes WHERE stgpool_name='</font><font color="#a020f0">$1</font><font color="#ff00ff">'</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">OK</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># User must specify a storage pool</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>if </b></font><font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>!</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>]</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>then</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Error: tsmmonitor tapesstgpool: You must specify a storage pool</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>fi</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Test if the parameters are numbers</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>if </b></font><font color="#a52a2a"><b>!</b></font>&nbsp;_tsmmonitor_tool is_number <font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$2</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$3</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>then</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Error: tsmmonitor tapesstgpool: invalid option -- '</font><font color="#a020f0">$2</font><font color="#ff00ff">' or '</font><font color="#a020f0">$3</font><font color="#ff00ff">'</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>fi</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Run the select statement</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">tsm_output</font>=<font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">_tsmmonitor_tool run_select tapesstgpool </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$sql</font><font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>||</b></font>&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Number of tapes in the storage pool</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">num_tapes</font>=<span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">echo </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$tsm_output</font><font color="#a52a2a"><b>&quot;</b></font><font color="#6a5acd">&nbsp;</font><font color="#a52a2a"><b>|</b></font><font color="#6a5acd">&nbsp;sed -n </font><font color="#a52a2a"><b>'</b></font><font color="#ff00ff">/^[0-9]/p</font><font color="#a52a2a"><b>'</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$num_tapes</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>-ge</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">2</font><font color="#a52a2a"><b>:-</b></font><font color="#a020f0">$TAPESSTGPOOL_WARNING</font><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Warning</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$num_tapes</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>-ge</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">3</font><font color="#a52a2a"><b>:-</b></font><font color="#a020f0">$TAPESSTGPOOL_CRITICAL</font><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Critical</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Print the script output and exit with the right return code</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;_tsmmonitor_tool myecho tapesstgpool <font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">number of tapes in storage pool </font><font color="#a020f0">$1</font><font color="#ff00ff">&nbsp;</font><font color="#a020f0">$num_tapes</font><font color="#ff00ff">, </font><font color="#a020f0">$status</font><font color="#a52a2a"><b>&quot;</b></font><br>
<font color="#008b8b">}</font><br>
<br>
<br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#0000ff"># check how many tsm db backup there are in the last N hours (default is 25h)</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># The default numbers are:</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;warning..: DBBKP_WARNING</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;critical.: DBBKP_CRITICAL</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># Usage..: tsmmonitor dbbkp [options] [warning] [critical]</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;-t, --type=I,F,S&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Specifies the type of backup to look for&nbsp;&nbsp; </font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Incremental,Full,dbSnapshot (default is full only)</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;-H, --hours=NUM_HOURS&nbsp;&nbsp;how many hours ago to search for db backup</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># Example: tsmmonitor dbbkp</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor dbbkp 2 1</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor dbbkp -H=12</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor dbbkp -H=12 2 1</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor dbbkp -H=12 -t=S</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor dbbkp -H=12 -t=F,S 2 1</font><br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#008b8b">dbbkp ()</font><br>
<font color="#008b8b">{</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;--help&quot;</font>&nbsp;<font color="#a52a2a"><b>-o</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;-h&quot;</font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#6a5acd">{</font>&nbsp;_ShowHelp <font color="#a020f0">$0</font>&nbsp;dbbkp<font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#a52a2a"><b>return</b></font><font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#6a5acd">}</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;local tsm_output num_bkp<br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">type</font>=F<br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">hours</font>=<font color="#a52a2a"><b>'</b></font><font color="#ff00ff">25</font><font color="#a52a2a"><b>'</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">OK</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">sql</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">SELECT count(*) FROM volhistory WHERE </font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">opt_type</font>=<font color="#a52a2a"><b>'</b></font><font color="#ff00ff">F|S|I|F,S|F,I|S,F|S,I|I,F|I,S|F,S,I|F,I,S|S,F,I|S,I,F|I,F,S|I,S,F</font><font color="#a52a2a"><b>'</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># parsing options</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;while <font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>]</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>do</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>case</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>in</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># how many hours ago</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-H=* <font color="#a52a2a"><b>|</b></font>&nbsp;--hours=* <font color="#a52a2a"><b>)</b></font>&nbsp;<font color="#008b8b">hours</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">1</font><span style="background-color: #ff0000"><font color="#ffffff">#*=</font></span><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;&nbsp; <font color="#a52a2a"><b>;;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># type of DB backup to look for</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-t=* <font color="#a52a2a"><b>|</b></font>&nbsp;--type=*&nbsp;&nbsp;<font color="#a52a2a"><b>)</b></font>&nbsp;<font color="#008b8b">type</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">1</font><span style="background-color: #ff0000"><font color="#ffffff">#*=</font></span><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;&nbsp; <font color="#a52a2a"><b>;;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>)</b></font>&nbsp;<font color="#a52a2a"><b>break</b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>;;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>esac</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>shift</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>done</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>if </b></font><font color="#a52a2a"><b>!</b></font>&nbsp;_tsmmonitor_tool is_number <font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$hours</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>then</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Error: tsmmonitor dbbkp: invalid option </font><font color="#a020f0">$hours</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>fi</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># is the type of db backup valid?</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>if </b></font><font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">echo </font><font color="#a020f0">$type</font><font color="#6a5acd">&nbsp;</font><font color="#a52a2a"><b>|</b></font><font color="#6a5acd">&nbsp;egrep -v </font><font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">^</font><font color="#a020f0">$opt_type</font><font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>]</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>then</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Error: tsmmonitor dbbkp: invalid db type '</font><font color="#a020f0">$type</font><font color="#ff00ff">'</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>fi</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">type</font>=<span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">echo </font><font color="#a020f0">$type</font><font color="#6a5acd">&nbsp;</font><font color="#a52a2a"><b>|</b></font><font color="#6a5acd">&nbsp;sed </font><font color="#a52a2a"><b>&quot;</b></font><br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; s/F/type='BACKUPFULL'/</font><br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; s/S/type='DBSNAPSHOT'/</font><br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; s/I/type='DBINCREMENTAL'/</font><br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; s/,/ OR /g</font><font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">sql</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$sql</font><font color="#ff00ff">&nbsp;date_time&gt;=current_timestamp-</font><font color="#a020f0">$hours</font><font color="#ff00ff">&nbsp;hours AND ( </font><font color="#a020f0">$type</font><font color="#ff00ff">&nbsp;)</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Test if the parameters are numbers</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>if </b></font><font color="#a52a2a"><b>!</b></font>&nbsp;_tsmmonitor_tool is_number <font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$2</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>then</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Error: tsmmonitor dbbkp: invalid option -- '</font><font color="#a020f0">$1</font><font color="#ff00ff">' or '</font><font color="#a020f0">$2</font><font color="#ff00ff">'</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>fi</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Run the select statement</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">tsm_output</font>=<font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">_tsmmonitor_tool run_select dbbkp </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$sql</font><font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>||</b></font>&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Number of db backups</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">num_bkp</font>=<span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">echo </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$tsm_output</font><font color="#a52a2a"><b>&quot;</b></font><font color="#6a5acd">&nbsp;</font><font color="#a52a2a"><b>|</b></font><font color="#6a5acd">&nbsp;sed -n </font><font color="#a52a2a"><b>'</b></font><font color="#ff00ff">/^[0-9][0-9]*$/p</font><font color="#a52a2a"><b>'</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$num_bkp</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>-le</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">1</font><font color="#a52a2a"><b>:-</b></font><font color="#a020f0">$DBBKP_WARNING</font><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Warning</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$num_bkp</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>-le</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">2</font><font color="#a52a2a"><b>:-</b></font><font color="#a020f0">$DBBKP_CRITICAL</font><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Critical</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Print the script output and exit with the right return code</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;_tsmmonitor_tool myecho dbbkp <font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">number of tsm db backup in the last </font><font color="#a020f0">${</font><font color="#a020f0">hours</font><font color="#a020f0">}</font><font color="#ff00ff">h </font><font color="#a020f0">$num_bkp</font><font color="#ff00ff">, </font><font color="#a020f0">$status</font><font color="#a52a2a"><b>&quot;</b></font><br>
<font color="#008b8b">}</font><br>
<br>
<br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#0000ff"># check number of nodes sessions</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># The default numbers are:</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;warning..: NUMSESS_WARNING</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;critical.: NUMSESS_CRITICAL</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># Usage..: tsmmonitor numsess [options] [warning] [critical] [session_state]</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">#&nbsp;&nbsp; -s, --state=SESSION_STATE&nbsp;&nbsp; Count only nodes sessions with a specifc state</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># Example: tsmmonitor numsess</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor numsess 100 150</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor numsess -s=MediaW 5 10</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor numsess -s=MediaW</font><br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#008b8b">numsess ()</font><br>
<font color="#008b8b">{</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;--help&quot;</font>&nbsp;<font color="#a52a2a"><b>-o</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;-h&quot;</font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#6a5acd">{</font>&nbsp;_ShowHelp <font color="#a020f0">$0</font>&nbsp;numsess<font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#a52a2a"><b>return</b></font><font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#6a5acd">}</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;local tsm_output num_sess sess_state<br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">OK</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">sql</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">SELECT count(*) FROM sessions WHERE session_type='Node'</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># options parser</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>case</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>in</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-s=* <font color="#a52a2a"><b>|</b></font>&nbsp;--state=* <font color="#a52a2a"><b>)</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">sess_state</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">1</font><span style="background-color: #ff0000"><font color="#ffffff">#*=</font></span><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">sql</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$sql</font><font color="#ff00ff">&nbsp;AND state='</font><font color="#a020f0">$sess_state</font><font color="#ff00ff">'</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>shift</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>;;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>esac</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Test if the parameters are numbers</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>if </b></font><font color="#a52a2a"><b>!</b></font>&nbsp;_tsmmonitor_tool is_number <font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$2</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>then</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Error: tsmmonitor numsess: invalid option -- '</font><font color="#a020f0">$1</font><font color="#ff00ff">' or '</font><font color="#a020f0">$2</font><font color="#ff00ff">'</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>fi</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Run the select statement</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">tsm_output</font>=<font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">_tsmmonitor_tool run_select numsess </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$sql</font><font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>||</b></font>&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Number of nodes sessions</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">num_sess</font>=<span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">echo </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$tsm_output</font><font color="#a52a2a"><b>&quot;</b></font><font color="#6a5acd">&nbsp;</font><font color="#a52a2a"><b>|</b></font><font color="#6a5acd">&nbsp;sed -n </font><font color="#a52a2a"><b>'</b></font><font color="#ff00ff">/^[0-9][0-9]*$/p</font><font color="#a52a2a"><b>'</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$num_sess</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>-ge</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">1</font><font color="#a52a2a"><b>:-</b></font><font color="#a020f0">$NUMSESS_WARNING</font><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Warning</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$num_sess</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>-ge</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">2</font><font color="#a52a2a"><b>:-</b></font><font color="#a020f0">$NUMSESS_CRITICAL</font><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Critical</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Print the script output and exit with the right return code</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;_tsmmonitor_tool myecho numsess <font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">number of nodes sessions </font><font color="#a020f0">$sess_state</font><font color="#ff00ff">&nbsp;</font><font color="#a020f0">$num_sess</font><font color="#ff00ff">, </font><font color="#a020f0">$status</font><font color="#a52a2a"><b>&quot;</b></font><br>
<font color="#008b8b">}</font><br>
<br>
<br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#0000ff"># check number of nodes</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># The default numbers are:</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;warning..: NUMNODES_WARNING</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;critical.: NUMNODES_CRITICAL</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># Usage..: tsmmonitor numnodes [options] [warning] [critical]</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;-d, --domain=DOMAIN&nbsp;&nbsp;Count nodes only in the DOMAIN</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># Example: tsmmonitor numnodes</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor numnodes 20 30</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor numnodes -d=SAP 20 30</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor numnodes -d=SAP</font><br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#008b8b">numnodes ()</font><br>
<font color="#008b8b">{</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;--help&quot;</font>&nbsp;<font color="#a52a2a"><b>-o</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;-h&quot;</font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#6a5acd">{</font>&nbsp;_ShowHelp <font color="#a020f0">$0</font>&nbsp;numnodes<font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#a52a2a"><b>return</b></font><font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#6a5acd">}</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;local tsm_output num_nodes domain<br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">OK</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">sql</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">SELECT count(*) FROM nodes</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># options parser</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>case</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>in</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-d=* <font color="#a52a2a"><b>|</b></font>&nbsp;--domain=* <font color="#a52a2a"><b>)</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">domain</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">1</font><span style="background-color: #ff0000"><font color="#ffffff">#*=</font></span><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">sql</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$sql</font><font color="#ff00ff">&nbsp;WHERE domain_name='</font><font color="#a020f0">$domain</font><font color="#ff00ff">'</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">domain</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">in domain </font><font color="#a020f0">$domain</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>shift</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>;;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>esac</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Test if the parameters are numbers</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>if </b></font><font color="#a52a2a"><b>!</b></font>&nbsp;_tsmmonitor_tool is_number <font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$2</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>then</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Error: tsmmonitor numnodes: invalid option -- '</font><font color="#a020f0">$1</font><font color="#ff00ff">' or '</font><font color="#a020f0">$2</font><font color="#ff00ff">'</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>fi</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Run the select statement</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">tsm_output</font>=<font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">_tsmmonitor_tool run_select numnodes </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$sql</font><font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>||</b></font>&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Number of nodes</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">num_nodes</font>=<span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">echo </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$tsm_output</font><font color="#a52a2a"><b>&quot;</b></font><font color="#6a5acd">&nbsp;</font><font color="#a52a2a"><b>|</b></font><font color="#6a5acd">&nbsp;sed -n </font><font color="#a52a2a"><b>'</b></font><font color="#ff00ff">/^[0-9][0-9]*$/p</font><font color="#a52a2a"><b>'</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">num_nodes</font><font color="#a52a2a"><b>:-</b></font><span style="background-color: #ff0000"><font color="#ffffff">0</font></span><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>-ge</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">1</font><font color="#a52a2a"><b>:-</b></font><font color="#a020f0">$NUMNODES_WARNING</font><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Warning</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">num_nodes</font><font color="#a52a2a"><b>:-</b></font><span style="background-color: #ff0000"><font color="#ffffff">0</font></span><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>-ge</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">2</font><font color="#a52a2a"><b>:-</b></font><font color="#a020f0">$NUMNODES_CRITICAL</font><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Critical</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Print the script output and exit with the right return code</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;_tsmmonitor_tool myecho numnodes <font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">number of nodes </font><font color="#a020f0">$domain</font><font color="#ff00ff">&nbsp;</font><font color="#a020f0">${</font><font color="#a020f0">num_nodes</font><font color="#a52a2a"><b>:-</b></font><span style="background-color: #ff0000"><font color="#ffffff">0</font></span><font color="#a020f0">}</font><font color="#ff00ff">, </font><font color="#a020f0">$status</font><font color="#a52a2a"><b>&quot;</b></font><br>
<font color="#008b8b">}</font><br>
<br>
<br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#0000ff"># check number of nodes locked</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># The default numbers are:</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;warning..: NUMNODESLOCKED_WARNING</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;critical.: NUMNODESLOCKED_CRITICAL</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># Usage..: tsmmonitor nodeslocked [options] [warning] [critical]</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;-d, --domain=DOMAIN&nbsp;&nbsp;Count nodes only in the DOMAIN</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># Example: tsmmonitor nodeslocked</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor nodeslocked 2 4</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor nodeslocked -d=SAP 2 4</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor nodeslocked -d=SAP</font><br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#008b8b">nodeslocked ()</font><br>
<font color="#008b8b">{</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;--help&quot;</font>&nbsp;<font color="#a52a2a"><b>-o</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;-h&quot;</font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#6a5acd">{</font>&nbsp;_ShowHelp <font color="#a020f0">$0</font>&nbsp;nodeslocked<font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#a52a2a"><b>return</b></font><font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#6a5acd">}</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;local tsm_output num_nodes domain<br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">OK</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">sql</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">SELECT count(*) FROM nodes WHERE locked='YES'</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># options parser</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>case</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>in</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-d=* <font color="#a52a2a"><b>|</b></font>&nbsp;--domain=* <font color="#a52a2a"><b>)</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">domain</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">1</font><span style="background-color: #ff0000"><font color="#ffffff">#*=</font></span><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">sql</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$sql</font><font color="#ff00ff">&nbsp;AND domain_name='</font><font color="#a020f0">$domain</font><font color="#ff00ff">'</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">domain</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">in domain </font><font color="#a020f0">$domain</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>shift</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>;;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>esac</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Test if the parameters are numbers</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>if </b></font><font color="#a52a2a"><b>!</b></font>&nbsp;_tsmmonitor_tool is_number <font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$2</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>then</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Error: tsmmonitor numnodes: invalid option -- '</font><font color="#a020f0">$1</font><font color="#ff00ff">' or '</font><font color="#a020f0">$2</font><font color="#ff00ff">'</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>fi</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Run the select statement</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">tsm_output</font>=<font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">_tsmmonitor_tool run_select nodeslocked </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$sql</font><font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>||</b></font>&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Number of nodes</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">num_nodes</font>=<span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">echo </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$tsm_output</font><font color="#a52a2a"><b>&quot;</b></font><font color="#6a5acd">&nbsp;</font><font color="#a52a2a"><b>|</b></font><font color="#6a5acd">&nbsp;sed -n </font><font color="#a52a2a"><b>'</b></font><font color="#ff00ff">/^[0-9][0-9]*$/p</font><font color="#a52a2a"><b>'</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$num_nodes</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>-ge</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">1</font><font color="#a52a2a"><b>:-</b></font><font color="#a020f0">$NUMNODESLOCKED_WARNING</font><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Warning</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$num_nodes</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>-ge</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">2</font><font color="#a52a2a"><b>:-</b></font><font color="#a020f0">$NUMNODESLOCKED_CRITICAL</font><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Critical</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Print the script output and exit with the right return code</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;_tsmmonitor_tool myecho nodeslocked <font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">number of nodes locked </font><font color="#a020f0">$domain</font><font color="#ff00ff">&nbsp;</font><font color="#a020f0">$num_nodes</font><font color="#ff00ff">, </font><font color="#a020f0">$status</font><font color="#a52a2a"><b>&quot;</b></font><br>
<font color="#008b8b">}</font><br>
<br>
<br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#0000ff"># check number of disk volumes without readwrite access</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># The default numbers are:</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;warning..: DISKVOL_WARNING</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;critical.: DISKVOL_CRITICAL</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># Usage..: tsmmonitor diskvol [warning] [critical]</font><br>
<font color="#0000ff"># Example: tsmmonitor diskvol</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor diskvol 2 3</font><br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#008b8b">diskvol ()</font><br>
<font color="#008b8b">{</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;--help&quot;</font>&nbsp;<font color="#a52a2a"><b>-o</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;-h&quot;</font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#6a5acd">{</font>&nbsp;_ShowHelp <font color="#a020f0">$0</font>&nbsp;diskvol<font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#a52a2a"><b>return</b></font><font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#6a5acd">}</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;local tsm_output num_vol_error<br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">OK</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">sql</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">SELECT count(*) FROM volumes WHERE \</font><br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;devclass_name='DISK' AND NOT access='READWRITE'</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Test if the parameters are numbers</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>if </b></font><font color="#a52a2a"><b>!</b></font>&nbsp;_tsmmonitor_tool is_number <font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$2</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>then</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Error: tsmmonitor diskvol: invalid option -- '</font><font color="#a020f0">$1</font><font color="#ff00ff">' or '</font><font color="#a020f0">$2</font><font color="#ff00ff">'</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>fi</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Run the select statement</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">tsm_output</font>=<font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">_tsmmonitor_tool run_select diskvol </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$sql</font><font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>||</b></font>&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Number of disk volumes without readwrite</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">num_vol_error</font>=<span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">echo </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$tsm_output</font><font color="#a52a2a"><b>&quot;</b></font><font color="#6a5acd">&nbsp;</font><font color="#a52a2a"><b>|</b></font><font color="#6a5acd">&nbsp;sed -n </font><font color="#a52a2a"><b>'</b></font><font color="#ff00ff">/^[0-9][0-9]*$/p</font><font color="#a52a2a"><b>'</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Test the diskvol status check</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$num_vol_error</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>-ge</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">1</font><font color="#a52a2a"><b>:-</b></font><font color="#a020f0">$DISKVOL_WARNING</font><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Warning</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$num_vol_error</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>-ge</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">2</font><font color="#a52a2a"><b>:-</b></font><font color="#a020f0">$DISKVOL_CRITICAL</font><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Critical</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Print the script output and exit with the right return code</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;_tsmmonitor_tool myecho diskvol <font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">number of disk volumes without readwrite access </font><font color="#a020f0">$num_vol_error</font><font color="#ff00ff">, </font><font color="#a020f0">$status</font><font color="#a52a2a"><b>&quot;</b></font><br>
<font color="#008b8b">}</font><br>
<br>
<br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#0000ff"># check number of database volumes not synchronized (copy status)</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># The default numbers are:</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;warning..: DBVOL_WARNING</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;critical.: DBVOL_CRITICAL</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># Usage..: tsmmonitor dbvol [warning] [critical]</font><br>
<font color="#0000ff"># Example: tsmmonitor dbvol</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor dbvol 2 3</font><br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#008b8b">dbvol ()</font><br>
<font color="#008b8b">{</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;--help&quot;</font>&nbsp;<font color="#a52a2a"><b>-o</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;-h&quot;</font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#6a5acd">{</font>&nbsp;_ShowHelp <font color="#a020f0">$0</font>&nbsp;dbvol<font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#a52a2a"><b>return</b></font><font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#6a5acd">}</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;local tsm_output num_vol_error<br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">OK</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">sql</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">SELECT count(*) FROM dbvolumes WHERE ( \</font><br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NOT copy1_status='Synchronized' OR</font><br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NOT copy2_status='Synchronized' OR</font><br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NOT copy3_status='Synchronized' )</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Test if the parameters are numbers</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>if </b></font><font color="#a52a2a"><b>!</b></font>&nbsp;_tsmmonitor_tool is_number <font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$2</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>then</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Error: tsmmonitor dbvol: invalid option -- '</font><font color="#a020f0">$1</font><font color="#ff00ff">' or '</font><font color="#a020f0">$2</font><font color="#ff00ff">'</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>fi</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Run the select statement</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">tsm_output</font>=<font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">_tsmmonitor_tool run_select dbvol </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$sql</font><font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>||</b></font>&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Number of volumes not synchronized</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">num_vol_error</font>=<span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">echo </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$tsm_output</font><font color="#a52a2a"><b>&quot;</b></font><font color="#6a5acd">&nbsp;</font><font color="#a52a2a"><b>|</b></font><font color="#6a5acd">&nbsp;sed -n </font><font color="#a52a2a"><b>'</b></font><font color="#ff00ff">/^[0-9][0-9]*$/p</font><font color="#a52a2a"><b>'</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Test the dbvol status check</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$num_vol_error</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>-ge</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">1</font><font color="#a52a2a"><b>:-</b></font><font color="#a020f0">$DBVOL_WARNING</font><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Warning</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$num_vol_error</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>-ge</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">2</font><font color="#a52a2a"><b>:-</b></font><font color="#a020f0">$DBVOL_CRITICAL</font><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Critical</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Print the script output and exit with the right return code</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;_tsmmonitor_tool myecho dbvol <font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">number of db volumes not synchronized </font><font color="#a020f0">$num_vol_error</font><font color="#ff00ff">, </font><font color="#a020f0">$status</font><font color="#a52a2a"><b>&quot;</b></font><br>
<font color="#008b8b">}</font><br>
<br>
<br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#0000ff"># check number of log volumes not synchronized (copy status)</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># The default numbers are:</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;warning..: LOGVOL_WARNING</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;critical.: LOGVOL_CRITICAL</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># Usage..: tsmmonitor logvol [warning] [critical]</font><br>
<font color="#0000ff"># Example: tsmmonitor logvol</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor logvol 2 3</font><br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#008b8b">logvol ()</font><br>
<font color="#008b8b">{</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;--help&quot;</font>&nbsp;<font color="#a52a2a"><b>-o</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;-h&quot;</font>&nbsp;<font color="#a52a2a"><b>]</b></font><font color="#a52a2a"><b>&amp;&amp;</b></font><font color="#6a5acd">{</font>&nbsp;_ShowHelp <font color="#a020f0">$0</font>&nbsp;logvol<font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#a52a2a"><b>return</b></font><font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#6a5acd">}</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;local tsm_output num_vol_error<br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">OK</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">sql</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">SELECT count(*) FROM logvolumes WHERE (</font><br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NOT copy1_status='Synchronized' OR</font><br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NOT copy2_status='Synchronized' OR </font><br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NOT copy3_status='Synchronized' )</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Test if the parameters are numbers</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>if </b></font><font color="#a52a2a"><b>!</b></font>&nbsp;_tsmmonitor_tool is_number <font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$2</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>then</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Error: tsmmonitor logvol: invalid option -- '</font><font color="#a020f0">$1</font><font color="#ff00ff">' or '</font><font color="#a020f0">$2</font><font color="#ff00ff">'</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>fi</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Run the select statement</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">tsm_output</font>=<font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">_tsmmonitor_tool run_select logvol </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$sql</font><font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>||</b></font>&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Number of volumes not synchronized</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">num_vol_error</font>=<span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">echo </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$tsm_output</font><font color="#a52a2a"><b>&quot;</b></font><font color="#6a5acd">&nbsp;</font><font color="#a52a2a"><b>|</b></font><font color="#6a5acd">&nbsp;sed -n </font><font color="#a52a2a"><b>'</b></font><font color="#ff00ff">/^[0-9][0-9]*$/p</font><font color="#a52a2a"><b>'</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Test de logvol status check</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$num_vol_error</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>-ge</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">1</font><font color="#a52a2a"><b>:-</b></font><font color="#a020f0">$LOGVOL_WARNING</font><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Warning</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$num_vol_error</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>-ge</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">2</font><font color="#a52a2a"><b>:-</b></font><font color="#a020f0">$LOGVOL_CRITICAL</font><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Critical</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Print the script output and exit with the right return code</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;_tsmmonitor_tool myecho logvol <font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">number of log volumes not synchronized </font><font color="#a020f0">$num_vol_error</font><font color="#ff00ff">, </font><font color="#a020f0">$status</font><font color="#a52a2a"><b>&quot;</b></font><br>
<font color="#008b8b">}</font><br>
<br>
<br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#0000ff"># Search for a specific ANR in the last N hours (default is 1h)</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># The default numbers are:</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;warning..: SEARCHANR_WARNING</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;critical.: SEARCHANR_CRITICAL</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># Usage..: tsmmonitor searchanr [options] &lt;ANR&gt; [warning] [critical]</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;-H, --hours=NUM_HOURS_AGO&nbsp;&nbsp; how many hours ago to search for</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># Example: tsmmonitor searchanr ANR8446W</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor searchanr ANR8446W 2 4</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor searchanr -H=12 ANR8446W</font><br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#008b8b">searchanr ()</font><br>
<font color="#008b8b">{</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;--help&quot;</font>&nbsp;<font color="#a52a2a"><b>-o</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;-h&quot;</font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#6a5acd">{</font>&nbsp;_ShowHelp <font color="#a020f0">$0</font>&nbsp;searchanr<font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#a52a2a"><b>return</b></font><font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#6a5acd">}</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;local tsm_output num_msg<br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">OK</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">hours</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">1</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># </font><span style="background-color: #ffff00"><font color="#0000ff">XXX</font></span><font color="#0000ff">: change to q aclot (faster)</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">sql</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">SELECT count(*) FROM actlog WHERE</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># parsing options</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>case</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>in</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># How many hours ago to search for</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-H=* <font color="#a52a2a"><b>|</b></font>&nbsp;--hours=* <font color="#a52a2a"><b>)</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">hours</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">1</font><span style="background-color: #ff0000"><font color="#ffffff">#*=</font></span><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>shift</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>;;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>esac</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>if </b></font><font color="#a52a2a"><b>!</b></font>&nbsp;_tsmmonitor_tool is_number <font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$hours</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>then</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Error: tsmmonitor searchanr: invalid option '</font><font color="#a020f0">$hours</font><font color="#ff00ff">'</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>fi</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># The user must specify the ANR</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>if </b></font><font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>!</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>]</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>then</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Error: tsmmonitor searchanr: You must specify a ANR.</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>fi</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">sql</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$sql</font><font color="#ff00ff">&nbsp;message LIKE'</font><font color="#a020f0">$1</font><font color="#ff00ff">%' AND date_time&gt;=current_timestamp-</font><font color="#a020f0">$hours</font><font color="#ff00ff">&nbsp;hours</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Test if the parameters are numbers</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>if </b></font><font color="#a52a2a"><b>!</b></font>&nbsp;_tsmmonitor_tool is_number <font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$2</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$3</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>then</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Error: tsmmonitor searchanr: invalid option -- '</font><font color="#a020f0">$2</font><font color="#ff00ff">' or '</font><font color="#a020f0">$3</font><font color="#ff00ff">'</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>fi</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Run the select statement</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">tsm_output</font>=<font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">_tsmmonitor_tool run_select searchanr </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$sql</font><font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>||</b></font>&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Number of messages</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">num_msg</font>=<span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">echo </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$tsm_output</font><font color="#a52a2a"><b>&quot;</b></font><font color="#6a5acd">&nbsp;</font><font color="#a52a2a"><b>|</b></font><font color="#6a5acd">&nbsp;sed -n </font><font color="#a52a2a"><b>'</b></font><font color="#ff00ff">/^[0-9][0-9]*$/p</font><font color="#a52a2a"><b>'</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$num_msg</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>-ge</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">2</font><font color="#a52a2a"><b>:-</b></font><font color="#a020f0">$SEARCHANR_WARNING</font><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Warning</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$num_msg</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>-ge</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">3</font><font color="#a52a2a"><b>:-</b></font><font color="#a020f0">$SEARCHANR_CRITICAL</font><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Critical</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Print the script output and exit with the right return code</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;_tsmmonitor_tool myecho searchanr <font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">number of messages with </font><font color="#a020f0">$1</font><font color="#ff00ff">&nbsp;in the last </font><font color="#a020f0">${</font><font color="#a020f0">hours</font><font color="#a020f0">}</font><font color="#ff00ff">h </font><font color="#a020f0">$num_msg</font><font color="#ff00ff">, </font><font color="#a020f0">$status</font><font color="#a52a2a"><b>&quot;</b></font><br>
<font color="#008b8b">}</font><br>
<br>
<br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#0000ff"># check number of DRM volumes</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># The default values are:</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;warning..: DRMVOL_WARNING</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;critical.: DRMVOL_CRITICAL</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># Usage..: tsmmonitor drmvol [options] [warning] [critical]</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff">#&nbsp;&nbsp;-l, --library=LIBRARY_NAME&nbsp;&nbsp;search volumes only in the library</font><br>
<font color="#0000ff">#&nbsp;&nbsp;-s, --state=DRM_STATE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DRM state of volumes (default: MOUNTABLE)</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VAULT,VAULTRETRIEVE,COURIERRETRIEVE</font><br>
<font color="#0000ff">#&nbsp;&nbsp;-i, --invert&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Invert the sense of matching, to select</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;non-matching volumes</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># Example: tsmmonitor drmvol</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor drmvol -i -l=3584LIB # DRM volumes with state different from MOUNTABLE in library</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor drmvol -s=COURIERRETRIEVE</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor drmvol -s=VAULT -l=3584LIB 1 8</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor drmvol 2 6</font><br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#008b8b">drmvol ()</font><br>
<font color="#008b8b">{</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;--help&quot;</font>&nbsp;<font color="#a52a2a"><b>-o</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;-h&quot;</font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#6a5acd">{</font>&nbsp;_ShowHelp <font color="#a020f0">$0</font>&nbsp;drmvol<font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#a52a2a"><b>return</b></font><font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#6a5acd">}</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;local tsm_output num_vol library<br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">OK</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">state</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">MOUNTABLE</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">type_match</font>=<font color="#a52a2a"><b>'</b></font><font color="#ff00ff">=</font><font color="#a52a2a"><b>'</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">sql</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">SELECT count(*) FROM drmedia WHERE</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">sql_in_lib</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">AND volume_name IN ( SELECT volume_name FROM libvolumes WHERE</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># parsing options</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;while <font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>]</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>do</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>case</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>in</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-s=* <font color="#a52a2a"><b>|</b></font>&nbsp;--state=*&nbsp;&nbsp; <font color="#a52a2a"><b>)</b></font>&nbsp;<font color="#008b8b">state</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">1</font><span style="background-color: #ff0000"><font color="#ffffff">#*=</font></span><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;&nbsp; <font color="#a52a2a"><b>;;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-l=* <font color="#a52a2a"><b>|</b></font>&nbsp;--library=* <font color="#a52a2a"><b>)</b></font>&nbsp;<font color="#008b8b">library</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">1</font><span style="background-color: #ff0000"><font color="#ffffff">#*=</font></span><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>;;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-i&nbsp;&nbsp; <font color="#a52a2a"><b>|</b></font>&nbsp;--invert&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>)</b></font>&nbsp;<font color="#008b8b">type_match</font>=<font color="#a52a2a"><b>'</b></font><font color="#ff00ff">&lt;&gt;</font><font color="#a52a2a"><b>'</b></font>&nbsp;&nbsp; <font color="#a52a2a"><b>;;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>)</b></font>&nbsp;<font color="#a52a2a"><b>break</b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#a52a2a"><b>;;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>esac</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>shift</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>done</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>if </b></font><font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$library</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>]</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>then</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">sql</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$sql</font><font color="#ff00ff">&nbsp;state</font><font color="#a020f0">$type_match</font><font color="#ff00ff">'</font><font color="#a020f0">$state</font><font color="#ff00ff">' </font><font color="#a020f0">$sql_in_lib</font><font color="#ff00ff">&nbsp;library_name='</font><font color="#a020f0">$library</font><font color="#ff00ff">' )</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">library</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">in library </font><font color="#a020f0">$library</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>else</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">sql</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$sql</font><font color="#ff00ff">&nbsp;state</font><font color="#a020f0">$type_match</font><font color="#ff00ff">'</font><font color="#a020f0">$state</font><font color="#ff00ff">'</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>fi</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Test if the parameters are numbers</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>if </b></font><font color="#a52a2a"><b>!</b></font>&nbsp;_tsmmonitor_tool is_number <font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$2</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>then</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Error: tsmmonitor drmvol: invalid option -- '</font><font color="#a020f0">$1</font><font color="#ff00ff">' or '</font><font color="#a020f0">$2</font><font color="#ff00ff">'</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>fi</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Run the select statement</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">tsm_output</font>=<font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">_tsmmonitor_tool run_select drmvol </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$sql</font><font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>||</b></font>&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">num_vol</font>=<span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">echo </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$tsm_output</font><font color="#a52a2a"><b>&quot;</b></font><font color="#6a5acd">&nbsp;</font><font color="#a52a2a"><b>|</b></font><font color="#6a5acd">&nbsp;sed -n </font><font color="#a52a2a"><b>'</b></font><font color="#ff00ff">/^[0-9]\{1,\}$/p</font><font color="#a52a2a"><b>'</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$num_vol</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>-ge</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">1</font><font color="#a52a2a"><b>:-</b></font><font color="#a020f0">$DRMVOL_WARNING</font><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Warning</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$num_vol</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>-ge</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">2</font><font color="#a52a2a"><b>:-</b></font><font color="#a020f0">$DRMVOL_CRITICAL</font><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Critical</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>if </b></font><font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$type_match</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">'='</font>&nbsp;<font color="#a52a2a"><b>]</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>then</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_tsmmonitor_tool myecho drmvol \<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">number of DRM volumes with state </font><font color="#a020f0">$state</font><font color="#ff00ff">&nbsp;</font><font color="#a020f0">$library</font><font color="#ff00ff">&nbsp;</font><font color="#a020f0">$num_vol</font><font color="#ff00ff">, </font><font color="#a020f0">$status</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>else</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_tsmmonitor_tool myecho drmvol \<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">number of DRM volumes different from </font><font color="#a020f0">$state</font><font color="#ff00ff">&nbsp;</font><font color="#a020f0">$library</font><font color="#ff00ff">&nbsp;</font><font color="#a020f0">$num_vol</font><font color="#ff00ff">, </font><font color="#a020f0">$status</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>fi</b></font><br>
<font color="#008b8b">}</font><br>
<br>
<br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#0000ff"># check the number of schedules not completed (only today's schedules)</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># The default numbers are:</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;warning..: SCHED_WARNING</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;critical.: SCHED_CRITICAL</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># Usage..: tsmmonitor sched [options] [warning] [critical]</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp; -a, --admin&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; only administrative schedules.</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp; -s, --schedule=SCHEDULE_NAME&nbsp;&nbsp;only a specific schedule</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># Example: tsmmonitor sched</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor sched -a</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor sched -s=DAILY_BKP 4 15</font><br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#008b8b">sched ()</font><br>
<font color="#008b8b">{</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;--help&quot;</font>&nbsp;<font color="#a52a2a"><b>-o</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;-h&quot;</font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#6a5acd">{</font>&nbsp;_ShowHelp <font color="#a020f0">$0</font>&nbsp;sched<font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#a52a2a"><b>return</b></font><font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#6a5acd">}</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;local tsm_output num_sched<br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">OK</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">sql</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">SELECT count(*) FROM events WHERE status&lt;&gt;'Completed' AND status&lt;&gt;'Future' AND status&lt;&gt;'Started'</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># parsing options</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;while <font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>]</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>do</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>case</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>in</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-a&nbsp;&nbsp; <font color="#a52a2a"><b>|</b></font>&nbsp;--admin&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>)</b></font>&nbsp;<font color="#008b8b">sql</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$sql</font><font color="#ff00ff">&nbsp;AND domain_name IS null</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;&nbsp;&nbsp;&nbsp; <font color="#a52a2a"><b>;;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-s=* <font color="#a52a2a"><b>|</b></font>&nbsp;--schedule=* <font color="#a52a2a"><b>)</b></font>&nbsp;<font color="#008b8b">sql</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$sql</font><font color="#ff00ff">&nbsp;AND schedule_name='</font><font color="#a020f0">${</font><font color="#a020f0">1</font><span style="background-color: #ff0000"><font color="#ffffff">#*=</font></span><font color="#a020f0">}</font><font color="#ff00ff">'</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>;;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#a52a2a"><b>)</b></font>&nbsp;<font color="#a52a2a"><b>break</b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>;;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>esac</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>shift</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>done</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Test if the parameters are numbers</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>if </b></font><font color="#a52a2a"><b>!</b></font>&nbsp;_tsmmonitor_tool is_number <font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$2</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>then</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Error: tsmmonitor sched: invalid option -- '</font><font color="#a020f0">$1</font><font color="#ff00ff">' or '</font><font color="#a020f0">$2</font><font color="#ff00ff">'</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>fi</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Run the select statement</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">tsm_output</font>=<font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">_tsmmonitor_tool run_select sched </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$sql</font><font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>||</b></font>&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Number of failed schedules</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">num_sched</font>=<span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">echo </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$tsm_output</font><font color="#a52a2a"><b>&quot;</b></font><font color="#6a5acd">&nbsp;</font><font color="#a52a2a"><b>|</b></font><font color="#6a5acd">&nbsp;sed -n </font><font color="#a52a2a"><b>'</b></font><font color="#ff00ff">/^[0-9][0-9]*$/p</font><font color="#a52a2a"><b>'</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$num_sched</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>-ge</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">1</font><font color="#a52a2a"><b>:-</b></font><font color="#a020f0">$SCHED_WARNING</font><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Warning</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$num_sched</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>-ge</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">2</font><font color="#a52a2a"><b>:-</b></font><font color="#a020f0">$SCHED_CRITICAL</font><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Critical</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;_tsmmonitor_tool myecho sched <font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">number of schedules not completed </font><font color="#a020f0">$num_sched</font><font color="#ff00ff">, </font><font color="#a020f0">$status</font><font color="#a52a2a"><b>&quot;</b></font><br>
<font color="#008b8b">}</font><br>
<br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#0000ff"># check server license compliance</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># Usage..: tsmmonitor lic</font><br>
<font color="#0000ff"># Example: tsmmonitor lic</font><br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#008b8b">lic ()</font><br>
<font color="#008b8b">{</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;--help&quot;</font>&nbsp;<font color="#a52a2a"><b>-o</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;-h&quot;</font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#6a5acd">{</font>&nbsp;_ShowHelp <font color="#a020f0">$0</font>&nbsp;lic<font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#a52a2a"><b>return</b></font><font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#6a5acd">}</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;local tsm_output lic_status<br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">sql</font>=<font color="#a52a2a"><b>'</b></font><font color="#ff00ff">SELECT compliance FROM licenses</font><font color="#a52a2a"><b>'</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Run the select statement</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">tsm_output</font>=<font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">_tsmmonitor_tool run_select lic </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$sql</font><font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>||</b></font>&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Get the license status</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">lic_status</font>=<span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><br>
<font color="#6a5acd">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$tsm_output</font><font color="#a52a2a"><b>&quot;</b></font><font color="#6a5acd">&nbsp;</font><font color="#a52a2a"><b>|</b></font><br>
<font color="#6a5acd">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sed -n </font><font color="#a52a2a"><b>'</b></font><br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/^ANS8000I/{</font><br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;n</font><br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p</font><br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</font><font color="#a52a2a"><b>'</b></font><br>
<font color="#6a5acd">&nbsp;&nbsp;&nbsp;&nbsp;</font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Check if status is valid</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>if </b></font><font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$lic_status</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;Valid&quot;</font>&nbsp;<font color="#a52a2a"><b>]</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>then</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_tsmmonitor_tool myecho lic <font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Valid Server License Compliance, OK</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>else</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_tsmmonitor_tool myecho lic <font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Failed Server License Compliance, Critical</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>fi</b></font><br>
<font color="#008b8b">}</font><br>
<br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#0000ff"># check false private tapes</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># The default percentages are:</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;warning..: FALSEPRIV_WARNING</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;critical.: FALSEPRIV_CRITICAL</font><br>
<font color="#0000ff">#</font><br>
<font color="#0000ff"># Usage..: tsmmonitor falseprivate [warning] [critical]</font><br>
<font color="#0000ff"># Example: tsmmonitor falseprivate</font><br>
<font color="#0000ff">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsmmonitor falseprivate 3 5</font><br>
<font color="#0000ff"># ----------------------------------------------------------------------------</font><br>
<font color="#008b8b">falseprivate ()</font><br>
<font color="#008b8b">{</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;--help&quot;</font>&nbsp;<font color="#a52a2a"><b>-o</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;-h&quot;</font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#6a5acd">{</font>&nbsp;_ShowHelp <font color="#a020f0">$0</font>&nbsp;falseprivate<font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#a52a2a"><b>return</b></font><font color="#a52a2a"><b>;</b></font>&nbsp;<font color="#6a5acd">}</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;local tsm_output num<br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">OK</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;local <font color="#008b8b">sql</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">select count(*) from libvolumes where status='Private' and \</font><br>
<font color="#ff00ff">&nbsp;&nbsp;&nbsp;&nbsp;last_use is null and volume_name not in (select volume_name from volumes )</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Test if the parameters are numbers</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>if </b></font><font color="#a52a2a"><b>!</b></font>&nbsp;_tsmmonitor_tool is_number <font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$2</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>then</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Error: tsmmonitor falseprivate: invalid option -- '</font><font color="#a020f0">$1</font><font color="#ff00ff">' or '</font><font color="#a020f0">$2</font><font color="#ff00ff">'</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>fi</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># Run the select statement</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">tsm_output</font>=<font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">_tsmmonitor_tool run_select falseprivate </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$sql</font><font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>||</b></font>&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">3</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">num</font>=<font color="#a52a2a"><b>&quot;</b></font><span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">echo </font><font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$tsm_output</font><font color="#a52a2a"><b>&quot;</b></font><font color="#6a5acd">&nbsp;</font><font color="#a52a2a"><b>|</b></font><font color="#6a5acd">&nbsp;sed -n </font><font color="#a52a2a"><b>'</b></font><font color="#ff00ff">/^[0-9][0-9]*$/p</font><font color="#a52a2a"><b>'</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># find out the current check status (ok/warning/critical)</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$num</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>-ge</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">1</font><font color="#a52a2a"><b>:-</b></font><font color="#a020f0">$FALSEPRIV_WARNING</font><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Warning</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$num</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>-ge</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">2</font><font color="#a52a2a"><b>:-</b></font><font color="#a020f0">$FALSEPRIV_CRITICAL</font><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;<font color="#008b8b">status</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Critical</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;_tsmmonitor_tool myecho falseprivate <font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">Num false privates </font><font color="#a020f0">$num</font><font color="#ff00ff">, </font><font color="#a020f0">$status</font><font color="#a52a2a"><b>&quot;</b></font><br>
<font color="#008b8b">}</font><br>
<br>
<font color="#0000ff">##############################################################################</font><br>
<font color="#0000ff">################################### Main #####################################</font><br>
<font color="#0000ff">##############################################################################</font><br>
<br>
<font color="#0000ff"># parsing global options</font><br>
<font color="#a52a2a"><b>while </b></font><font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>!=</b></font>&nbsp;<font color="#a52a2a"><b>&quot;&quot;</b></font>&nbsp;<font color="#a52a2a"><b>]</b></font><br>
<font color="#a52a2a"><b>do</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>case</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>in</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-h&nbsp;&nbsp; <font color="#a52a2a"><b>|</b></font>&nbsp;--help&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#a52a2a"><b>)</b></font>&nbsp;_tsmmonitor_tool program_help&nbsp;&nbsp;&nbsp;&nbsp; <font color="#a52a2a"><b>;;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-V&nbsp;&nbsp; <font color="#a52a2a"><b>|</b></font>&nbsp;--version&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>)</b></font>&nbsp;_tsmmonitor_tool program_version&nbsp;&nbsp;<font color="#a52a2a"><b>;;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-s=* <font color="#a52a2a"><b>|</b></font>&nbsp;--servername=* <font color="#a52a2a"><b>)</b></font>&nbsp;<font color="#008b8b">SERVERNAME</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">-servername=</font><font color="#a020f0">${</font><font color="#a020f0">1</font><span style="background-color: #ff0000"><font color="#ffffff">#*=</font></span><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;&nbsp;<font color="#a52a2a"><b>;;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-u=* <font color="#a52a2a"><b>|</b></font>&nbsp;--user=*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#a52a2a"><b>)</b></font>&nbsp;<font color="#008b8b">USER</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">1</font><span style="background-color: #ff0000"><font color="#ffffff">#*=</font></span><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>;;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-p=* <font color="#a52a2a"><b>|</b></font>&nbsp;--pass=*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#a52a2a"><b>)</b></font>&nbsp;<font color="#008b8b">PASS</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">1</font><span style="background-color: #ff0000"><font color="#ffffff">#*=</font></span><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>;;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-m=* <font color="#a52a2a"><b>|</b></font>&nbsp;--mail=*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#a52a2a"><b>)</b></font>&nbsp;<font color="#008b8b">MAILTO</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">${</font><font color="#a020f0">1</font><span style="background-color: #ff0000"><font color="#ffffff">#*=</font></span><font color="#a020f0">}</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>;;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-S&nbsp;&nbsp; <font color="#a52a2a"><b>|</b></font>&nbsp;--source&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#a52a2a"><b>)</b></font>&nbsp;<font color="#008b8b">SHOW_CHECK_SOURCE</font>=<font color="#ff00ff">1</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#a52a2a"><b>;;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-d&nbsp;&nbsp; <font color="#a52a2a"><b>|</b></font>&nbsp;--debug&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>)</b></font>&nbsp;<font color="#008b8b">DEBUG</font>=<font color="#ff00ff">1</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#a52a2a"><b>;;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-q&nbsp;&nbsp; <font color="#a52a2a"><b>|</b></font>&nbsp;--quiet&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>)</b></font>&nbsp;<font color="#008b8b">QUIET</font>=<font color="#ff00ff">1</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#a52a2a"><b>;;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># probably, $1 has the function (check)</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <font color="#a52a2a"><b>)</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">func</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$1</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># tsm base query command. usually, you do not need to touch here</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">TSM_CMD</font>=<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$DSMADMC</font><font color="#ff00ff">&nbsp;</font><font color="#a020f0">$SERVERNAME</font><font color="#ff00ff">&nbsp;-tab -id=</font><font color="#a020f0">$USER</font><font color="#ff00ff">&nbsp;-password=</font><font color="#a020f0">$PASS</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_Debug <font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">TSM_CMD = </font><font color="#a020f0">$TSM_CMD</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_Debug <font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">MAILTO = </font><font color="#a020f0">$MAILTO</font><font color="#a52a2a"><b>&quot;</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># is there the function?</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>if </b></font>type <font color="#a020f0">$func</font>&nbsp;<font color="#a52a2a"><b>&gt;</b></font>&nbsp;/dev/null <font color="#ff00ff">2</font><font color="#a52a2a"><b>&gt;</b></font>&nbsp;/dev/null<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>then</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># print the function (check) source code only</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$SHOW_CHECK_SOURCE</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>=</b></font>&nbsp;<font color="#ff00ff">&quot;1&quot;</font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>&amp;&amp;</b></font>&nbsp;_tsmmonitor_tool mysource <font color="#a020f0">$func</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>shift</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># file to record check status</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">StatusFile</font>=<font color="#a020f0">${</font><font color="#a020f0">func</font><font color="#a020f0">}</font>_<span style="background-color: #ff0000"><font color="#ffffff">$(</font></span><font color="#6a5acd">echo </font><font color="#a020f0">$*</font><font color="#6a5acd">&nbsp;</font><font color="#a52a2a"><b>|</b></font><font color="#6a5acd">&nbsp;sed </font><font color="#a52a2a"><b>'</b></font><font color="#ff00ff">s/ /_/g</font><font color="#a52a2a"><b>'</b></font><span style="background-color: #ff0000"><font color="#ffffff">)</font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># execute the check ($func) function</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a020f0">$func</font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$@</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>else</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>echo</b></font><font color="#ff00ff">&nbsp;</font><font color="#a52a2a"><b>&quot;</b></font><font color="#ff00ff">tsmmonitor: check '</font><font color="#a020f0">$func</font><font color="#ff00ff">' not found (try --help)</font><font color="#a52a2a"><b>&quot;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">1</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>fi</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>;;</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>esac</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># In some sh implementation, if there is no more option we get the error</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"># error: shift: bad number</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>[</b></font>&nbsp;<font color="#a52a2a"><b>&quot;</b></font><font color="#a020f0">$2</font><font color="#a52a2a"><b>&quot;</b></font>&nbsp;<font color="#a52a2a"><b>!=</b></font>&nbsp;<font color="#a52a2a"><b>&quot;&quot;</b></font>&nbsp;<font color="#a52a2a"><b>]</b></font>&nbsp;<font color="#a52a2a"><b>||</b></font>&nbsp;<font color="#a52a2a"><b>break</b></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>shift</b></font><br>
<font color="#a52a2a"><b>done</b></font><br>
<br>
<font color="#a52a2a"><b>exit</b></font>&nbsp;<font color="#ff00ff">0</font><br>
<br>
<font color="#0000ff"># vim: ts=4</font><br>
</font></body>
</html>
